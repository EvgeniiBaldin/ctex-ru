%  -*- coding: koi8-r -*-
\chapter{Вёрстка}
\label{cha:make-up}

{\setlength{\epigraphwidth}{0.65\textwidth} \epigraph{Автору
    сравнительно легко потратить немного лишнего времени на какие-то
    детали, потому что он потратил гораздо больше времени на написание
    книги.}{\emph{Дональд Э.\,Кнут}}}


Волшебных текстовых процессоров не существует. Телепатией программы
пока не обладают. Они, естественно, делают то, что им сказано, но вкус
и чувство прекрасного у них полностью отсутствует. В конце
занимательного приключения по созданию текстов частенько приходится
брать управление в свои руки, дабы навести лоск на почти готовое
произведение.


Вёрстка "--- составление страниц (полос) газеты, журнала, книги
определённого размера из набранных строк, заголовков, иллюстраций и
тому подобного в соответствие с разметкой или макетом. В этой главе разберёмся
с тем, как задавать размеры, что такое макет полосы набора и как
<<удерживать>> текст в рамках дозволенного.

Здесь присутствует далеко не вся информация, необходимая при вёрстке
текста. Несмотря на то, что \LaTeX{} позволяет верстать книги
любителям без помощи профессионалов, но лучше при любой возможности
спрашивать у этих профессионалов совета. Здесь очень важно понимание
\emph{что}, \emph{где} и \emph{зачем} надо исправлять, потому что способ
решения \emph{уже} известной проблемы, как правило, очевиден.

\begin{figure}[p]
  \centering%центрируем картинку
  \includegraphics[width=0.88\linewidth]{make-up/make-up-layout.eps}
  \caption{Макет полосы набора класса scrartcl с опцией
    a4paper (результат выполнения команды \textcmd{layout} из
    пакета \textpkg{layout})}\label{fig:make-up-layout}
\end{figure}

\section{Скелет страницы}
\label{sec:make-up:layout}

\mindex{страница|(}
\textcmdh{layout}

На рис.~\ref{fig:make-up-layout} приведён результат выполнения команды
\textcmd{layout} из одноимённого пакета.   Основное место на
странице занимает текст "--- это тело текста. 

Справа и слева от текста расположены поля. Поля обычно остаются
пустыми, но иногда они используются для заметок (маргиналий или
фонариков). В верхней и нижней части страницы расположены
соответственно верхний и нижний колонтитулы. Колонтитул представляет
собой справочную строку, помогающую ориентироваться в структуре
текста.



Совокупность размеров и расположений указанных полей, а также вид и
содержание колонтитулов называется \emph{макетом полосы набора}. На
рис.~\ref{fig:make-up-layout} пунктирной линией изображены \emph{поля
  драйвера} (\textcircled{\scriptsize 1} и \textcircled{\scriptsize
  2}). Относительно этих базовых полей выстраиваются все остальные поля. По
договорённости отступы до полей драйвера равны одному
дюйму. Переопределив \textcmd{hoffset} и \textcmd{voffset} (по
умолчанию они равны нулю), можно легко сдвинуть полосу набора целиком
по горизонтали и вертикали соответственно.

Далее перечислены параметры, которые управляют макетом полосы набора.
\begin{itemize}
\item Тело текста характеризуется высотой \textcmd{texthight}
  \textcircled{\scriptsize 7} и шириной \textcmd{textwidth}
  \textcircled{\scriptsize 8}. При многоколоночной вёрстке ширина колонки
  равна \textcmd{columnwidth}. Переменная \textcmd{linewidth}
  принимает значение, равное длине строки текущего текста.
\item \textcmd{oddsidemargin} \textcircled{\scriptsize 3} добавляется
  слева в случае односторонней печати. При~двухсторонней печати полосы
  набора для чётных и нечётных страниц различаются. В этом случае для
  нечётных страниц слева опять же добавляется \textcmd{oddsidemargin},
  а для чётных "--- \textcmd{evensidemargin}.
\item Верхний колонтитул располагается на расстоянии
  \textcmd{topmargin} \textcircled{\scriptsize 4} от поля драйвера, имеет высоту
  \textcmd{headheight} \textcircled{\scriptsize 5}, а тело текста отступает от колонтитула
  на расстояние \textcmd{headsep} \textcircled{\scriptsize 6}.
\item \textcmd{footskip} позиционирует базовую линию нижнего
  колонтитула относительно последней строки текста.
\item Поля для заметок имеют ширину \textcmd{marginparwidth}
  \textcircled{\scriptsize 10} и
  отступают от тела текста на расстояние \textcmd{marginparsep}
  \textcircled{\scriptsize 9}. Ещё одна опция управляет минимальным расстоянием между
  заметками: \textcmd{marginparpush}.
\end{itemize}

\mindex{страница|)}

\subsection{Выбор размера бумаги}
\label{sec:make-up:a4paper}

\mindex{страница!размер|(}


Размер листа бумаги описывается переменными
\textcmd{paperwidth} и \textcmd{paperheight}. Стандартные
базовые классы \LaTeX{} (\textpkg{article}, \textpkg{book},
\textpkg{report} и \textpkg{letter}) по умолчанию предполагают, что для
печати используется бумага формата \textpkg{letter}. Очевидно это
умолчание не годится для России, где стандартом является формат A4
(\(210\hm{\times}297\)\,мм$^2$). Обычно установить правильный формат можно с
помощью передачи параметра \textopt{a4paper} при выборе класса
документа:
\begin{lstlisting}
|\bs|documentclass[a4paper,12pt,oneside]{scrbook} 

\end{lstlisting}

Для создания небольших брошюрок со страницей размера A5 (половина
размера~A4) используется опция \textopt{a5paper}.

\mindex{страница!размер|)}

\subsection{Ориентация}
\label{sec:make-up:orientation}

Для портретной и альбомной ориентации вообще-то требуются разные макеты
полосы набора. Альбомная ориентация может использоваться по умолчанию
в~некоторых специализированных классах (например, \textpkg{slides}).

\begin{figure}[h]
  \centering%центрируем картинку
  \begin{minipage}[b]{0.39\linewidth}\centering
    \fbox{\includegraphics[clip,width=0.7\linewidth]{make-up/make-up-lscape.eps}}
    \caption{\textpkg{lscape} в действии}\label{fig:make-up:lscape}
  \end{minipage}\quad
  \begin{minipage}[b]{0.5\linewidth}
    \includegraphics[width=\linewidth]{make-up/make-up-rotpages.eps}
    \caption{\textpkg{rotpages} в действии}\label{fig:make-up:rotpages}
  \end{minipage}
\end{figure}

Если повернуть требуется только текст без изменения полей
колонтитулов, то проще всего воспользоваться окружением
\textenv{landscape} из пакета \textpkg{lscape}. Всё, что находится
внутри этого окружения, поворачивается на 90 градусов против часовой
стрелки. Во время использования \textprog{pdflatex} для изменения
ориентации не только текста, но и страницы (дабы не наклонять при
чтении текста голову на~бок), при~загрузке пакета следует передать ему
опцию \textopt{pdftex} или воспользоваться пакетом"=надстройкой
\textpkg{pdflscape}.


Лучше не менять параметры макета во время набора, но если очень
хочется, то можно воспользоваться стандартным пакетом
\textpkg{portland}, который позволяет на~лету менять
портретную ориентацию на альбомную и обратно, переопределяя
соответствующие управляющие макетом переменные. Команды
\textcmd{portrait}  и \textcmd{landscape} работают как
переключатели между этими режимами. В пакете определены и одноимённые
с переключателями окружения. Это довольно низкоуровневый пакет, и
пользоваться им надо аккуратно. \textenvh{landscape} \textenvh{portrait}

Если по какой-то причине потребуется развернуть текст на 180
градусов\footnote{Например, для написания задачника с решениями, чтобы
  осложнить обучающемуся чтение решения сразу после прочтения задачи.},
можно воспользоваться пакетом \textpkg{rotpages}. В пакете определены
два переключателя режима \textcmd{rotboxpages} и
\textcmd{endrotboxpages}, которые указывают границы повёрнутого 
вверх ногами текста. Пакет умеет разворачивать не только страницы, но
и колонки.  Подробности в документации \textfile{rotpages-doc.pdf}


\section{Меняем макет}
\label{sec:make-up:changing-layout}

\mindexemph{макет}

Причина, по которой неискушённый \TeXник начинает менять макет полосы
набора, обычно заключается в том, что он использует стандартные классы
\LaTeX: один из четвёрки \textpkg{article}, \textpkg{book},
\textpkg{report} или \textpkg{letter}. Это очень древние классы, и на
них много чего <<завязано>>, поэтому они пребывают в абсолютно
замороженном состоянии. Лучше для начала найти себе другой
базовый класс <<по~душе>>. Например, \textpkg{scrartcl},
\textpkg{scrbook}, \textpkg{scrreprt} и \textpkg{scrlettr} "--- классы
из коллекции \textpkg{KOMA-Script}, которые, дублируя функциональность
стандартной четвёрки, ориентируются на европейских пользователей и
размер листа A4. А.\,И.~Роженко в рамках коллекции \textpkg{ncclatex}
(\NCC) предоставляет класс \textpkg{ncc}, ориентированный на русских
\TeXников.


\subsection{Двигаем размеры}
\label{sec:make-up:changing-size}


Выбор, естественно, не ограничивается упомянутыми ранее классами "---
он огромен. Поэтому прежде чем что-то изменять, следует внимательно
изучить уже имеющиеся решения. И даже если вы знаете что делаете,
лучше не переопределять вручную переменные, управляющие размерами
макета полосы набора. Правильным решением будет воспользоваться одним
из уже имеющих специализированных пакетов, например:
\textpkg{geometry}, \textpkg{vmargin} или \textpkg{typearea}.
\smallskip

\Note Ещё раз: <<Макет лучше не менять!>>

\subsubsection{geometry}
\label{sec:make-up:geometry}

\mindex{страница!размер|(}

Пакет \textpkg{geometry} меняет размеры прямо в процессе загрузки
стилевого файла, например так:
\begin{lstlisting}[]
\usepackage[height=25cm,a4paper,hmargin={3cm,2cm}]{geometry}

\end{lstlisting}

Разбор параметров выполняется с помощью пакета \textpkg{keyval},
который уже упоминался в главе~\ref{cha:graphics}.  В
качестве параметров можно передавать выражения, если загружен пакет
\textpkg{calc}. 

Список воспринимаемых пакетом опций очень обширен. В документации 
к~пакету \textfile{geometry.pdf} подробное описание всех имеющихся опций
занимает свыше пяти страниц текста. Использование этого пакета для
изменения размеров полей  предпочтительнее, чем изменение
размеров напрямую. Обилие принимаемых параметров позволят выразить
любую идею по формату полосы набора в наиболее естественной форме без
ошибок в расчётах. Подробное описание пакета, к сожалению, выходит
за все разумные рамки объёма книги. К счастью,  
имеется очень хорошая и чрезвычайно подробная документация.

\mindex{страница!размер|)}

\subsubsection{vmargin}
\label{sec:make-up:vmargin}

\mindex{страница!поля|(}

Пакет \textpkg{vmargin} управляет размерами макета через выставку
полей. Перед выставкой полей следует задать формат листа:
\begin{lstlisting}[]
\setpapersize[|<<ориентация>>|]{|<<формат листа>>|}

\end{lstlisting}

В качестве обязательного параметра команды можно указать один из
следующих форматов: A0, A1, \ldots, A9, B0, B1, \ldots, B9, C0,
\ldots, C9, USletter, USlegal и USexecutive. Необязательный параметр
может принимать значения \textopt{landscape} (альбомная ориентация) или 
\textopt{portrait} (портретная ориентация по умолчанию). Для 
нестандартных форматов листа можно задать размеры с помощью ключевого
слова \textopt{custom} команды:
\begin{lstlisting}[]
\setpapersize{custom}{|<<ширина>>|}{|<<высота>>|}

\end{lstlisting}

После того как удалось определиться с размером страницы, можно задавать
размеры для полосы набора с помощью одной из следующих команд:

\begin{lstlisting}
% Полоса набора с колонтитулами
\setmargins{|<<ширина поля слева>>|}{|<<высота поля сверху>>|}%
           {|<<ширина текста>>|}{|<<высота текста>>|}%
           {|<<высота>>|}{|<<отступ>>|}%верхний колонтитул
           {|<<высота>>|}{|<<отступ>>|}%нижний колонтитул
% Полоса набора без колонтитулов
\setmargnohf{|<<ширина поля слева>>|}{|<<высота поля сверху>>|}%
            {|<<ширина текста>>|}{|<<высота текста>>|}%
% Установка размеров без изменения колонтитулов
\setmarg{|<<ширина поля слева>>|}{|<<высота поля сверху>>|}%
        {|<<ширина текста>>|}{|<<высота текста>>|}%

\end{lstlisting}

Кроме перечисленных команд в \textpkg{vmargin} определены их аналоги:
\textcmd{setmarginsrb}, \textcmd{setmargnohfrb},
\textcmd{setmargrb}. Отличие этих команд от вышеупомянутых
заключается в том, что в качестве параметров вместо ширины и высоты тела
текста им передаются ширина правого поля и высота нижнего поля.
Подробно пакет описан в документации \textfile{vmargin.pdf}.

\mindex{страница!поля|)}

\subsubsection{typearea}
\label{sec:make-up:typearea}

\mindex{страница!размер|(}
Стиль \textpkg{typearea} из всеобъемлющего пакета
\textpkg{KOMA-Script} создавался специально под классы, определённые в
этом пакете (\textpkg{scrartcl}, \textpkg{scrbook} и т.\,д.), но может
использоваться и отдельно. Параметры макета по умолчанию вычисляются
автоматически по правилам, сформулированным Яном Чихольдом (Jan
Tschichold).

\textpkg{typearea} используется примерно так же, как
\textpkg{geometry}, то есть параметры макета можно передать при
инициализации:
\begin{lstlisting}[]
\usepackage[BCOR8.25mm]{typearea}
\end{lstlisting}

\textopt{BCOR} (binding correction) "--- ширина, идущая на переплёт
или выпадающая из~полезной площади по какой-то другой причине. 

Если в качестве класса документа выбран один из семейства \textpkg{KOMA-Script},
то опции, передаваемые \textpkg{typearea}, следует объявлять прямо во время
инициализации класса: 
\begin{lstlisting}[]
% Загружается класс из KOMA-Script
\documentclass[pagesize]{scrbook} 
% Устанавливается размер страницы 70х100М/16
\setlength{\paperwidth}{170mm}
\setlength{\paperheight}{240mm}
% Устанавливается размер полосы
\areaset{130mm}{194mm}

\end{lstlisting}

Опция \textopt{pagesize}  указывает пакету \textpkg{typearea}, что при
компиляции необходимо добавить дополнительные управляющие команды, для
того чтобы dvi"=драйверы (такие как \textprog{dvips},
\textprog{xdvi} и так далее) правильно определяли нестандартные размеры
бумаги. Иначе размер бумаги, отличный от умолчания, придётся задавать
при исполнении этих программ.

Формат издания, установленный ГОСТ 5773-90, приводит к тому, что
размер страницы отличается от международных стандартов (например, от
A1, A2, A3, A4 и так далее). За размер бумаги отвечают переменные
\textcmd{paperwidth} и \textcmd{paperheight} "--- ширина и высота
страницы соответственно. Для установки размеров полосы текста в
пакете \textpkg{typearea} определена команда \textcmd{areaset}, первый
обязательный аргумент которой соответствует ширине текста, а второй "---
\mbox{высоте}.

Подробности можно найти в описании \textpkg{KOMA-Script}
(\textfile{scrguien.pdf}) в главе <<Cons\-truction of the Page Layout
with typearea>>. Перед использованием \emph{придётся} прочитать
инструкцию.

\mindex{страница!размер|)}

\subsubsection{typogrid}
\label{sec:make-up:typogrid}

\mindex{типографская решётка}


Для визуального контроля при создании макета, возможно, будет удобно
воспользоваться пакетом \textpkg{typogrid}, который наносит на лист
типографскую решётку. Решётка наносится только в случае, если в
качестве параметра пакету или классу документа передаётся опция
\textopt{draft}, и соответственно опция \textopt{final} отменяет
действие пакета.

Пакету можно передать число колонок, которые должна сформировать
решётка, с помощью опции \textopt{columns=число}. По умолчанию число
равно 12.

\subsection{Стили страницы}
\label{sec:make-up:pagestyle}


Полоса набора "--- это не только размеры, это ещё и наполнение
колонтитулов. Обычно наполнение колонтитулов определяется в классе
документа. Лучше без~необходимости ничего не менять.

Простейший способ изменить стиль страницы "--- это воспользоваться
командой:
\begin{lstlisting}[]
\pagestyle{|<<стиль страницы>>|}

\end{lstlisting}

Если стиль надо переопределить только для текущей страницы, то следует
воспользоваться командой \textcmd{thispagestyle}\lstinline!{стиль страницы}!.

Есть три стандартно определённых стиля:
\smallskip

\begin{eqlist}
\item[empty] "--- страница выводится без каких-либо колонтитулов "---
  только текст.
\item[plain] "--- выводится только номер страницы в нижнем колонтитуле.
\item[headings] "--- в верхнем колонтитуле выводится номер страницы и
  информация, определяемая классом документа.
\end{eqlist}

Если и это наполнение не устраивает, то можно определить свой
собственный стиль. Пакет \textpkg{fancyhdr}, подробно описанный в
разделе~\ref{sec:colontitles} на
странице~\pageref{sec:apparatus:fancyhdr}, специализируется как раз на
этом.

\subsection{Буклеты}
\label{sec:make-up:booklets}

\mindex{буклет|(}

Если требуется быстро сделать <<буклет-раскладушку>> формата A5 и есть
готовый PostScript со страницами формата A4, то утилиты из
программного пакета \textprog{psutils}, скорее всего, позволят получить
желаемый результат:
\begin{lstlisting}[language=bash,escapechar=!,frame=]
> cat !<<исходный файл>>!.ps | psbook | psnup -2 > !<<буклет>>!.ps  

\end{lstlisting}

Исполняемый файл \textprog{psbook} меняет порядок страниц так, чтобы
получился двухсторонний буклет, а \textprog{psnup} с ключом
\textopt{-2} размещает по две страницы на~одной. Затем получившийся
PostScipt можно распечатать. Если хочется чего-то более специального,
то следует прочитать документацию, идущую к пакету, и, возможно,
особенно внимательно  приглядеться к исполняемому файлу
\textprog{pstops}.

Для простого размещения двух страниц на одной можно просто распечатать
результирующий pdf"=файл, например, с помощью \textprog{Adobe
  Reader} или \textprog{kpdf}, соответствующим образом изменив опции
печати. Также при работе с pdf"=файлами представляет интерес
пакет \textpkg{pdfpages}, позволяющий манипулировать
pdf"=страницами внешних pdf"=документов.

\subsubsection{twoup}
\label{sec:make-up:twoup}

Пакет \textpkg{twoup} позволяет решить проблему создания буклетов без
внешних утилит. Он зависит от пакета \textpkg{booklet}, который
специализируется на изменении порядка следования страниц, то есть
является аналогом \textprog{psbook}.

Для использования \textpkg{twoup} достаточно в преамбуле при загрузке
класса указать размер используемой бумаги и загрузить стили
\textpkg{booklet} и \textpkg{twoup}:
\begin{lstlisting}
\documentclass[a4paper,12pt]{scrbook} 
\usepackage[print]{booklet} 
\usepackage{twoup}
\end{lstlisting}

Опция \textopt{print} инициализирует реорганизацию страниц. 

После компиляции программе \textprog{dvips}, возможно, придётся 
вручную передать размеры листа:
\begin{lstlisting}[language=bash,frame=]
> dvips -T 29.6cm,21.0cm |имя dvi-файла|
\end{lstlisting}

Теперь получившийся буклет можно печатать

\mindex{буклет|)}

\subsubsection{pgfpages}
\label{sec:make-up:pgfpages}

\textpkg{pgfpages} из пакета \textpkg{pgf} представляет собой
 набор макросов, позволяющих автору разместить несколько страниц
текста на одной без использования сторонних
программ. \textpkg{pgfpages} перехватывает управление у \TeX{} в
момент окончания формирования страницы и размещает её внутри бокса, не
выходя за пределы инструкций \TeX.  Из недостатков \textpkg{pgfpages}
следует упомянуть, что с этим пакетом перестают работать
гиперссылки.% \footnote{Это связано с недостатком спецификации
%   гиперсссылок в PDF "--- они ссылаются внутри страницы в терминах
%   абсолютных координат и линейные преобразования на них не действуют.}

Для того чтобы разметить две страницы, можно набрать следующий код:
\begin{lstlisting}
% Преамбула
\usepackage{pgfpages}
\pgfpagesuselayout{2 on 1}[a4paper,landscape,%
                                   border shrink=5mm]
\begin{document}
Текст на левой странице
\clearpage
Текст на правой странице
\end{document}
\end{lstlisting}

Макросу \textcmd{pgfpagesuselayout} передаётся команда о размещении
двух страниц на~одной (\textopt{2 on 1}). Также макросу передаётся
список опций:
\begin{eqlist}
\item[\textopt{a4paper}] "--- результирующая страница должна быть
  размера A4,
\item[\textopt{landscape}] "--- ориентация результирующей страницы альбомная,
\item[\textopt{border shrink=5mm}] "--- сформировать  отступ от краёв
  в 5\,мм.
\end{eqlist}

Подробности следует искать в документации к \textpkg{pgf}
(\textfile{pgfmanual.pdf}) в главе <<Page Management>>.




\section{<<Причёсываем>> текст}
\label{sec:make-up:text}

\mindex{дефекты набора}

После того как границы определены, посмотрим, что можно сделать для
красивого размещения текста на странице. Часть забот по следованию
правилам вёрстки \LaTeX{} берёт на себя. Например, вовсе не требуется
следить за единообразием оформления полос. Но есть дефекты, которые
компьютеру заметить не под~силу, например, так называемые коридоры,
один из которых демонстрируется на~рис.~\ref{fig:make-up:corridor}.


\begin{figure}
  \centering%центрируем картинку
  \hfill
  \includegraphics[width=0.55\textwidth]{make-up/make-up-coridor.eps}
  \hfill
  \includegraphics[width=0.35\textwidth]{make-up/make-up-draft.eps}
  \hfill
  \smallskip

  \hfill
  \parbox{0.55\textwidth}{\caption{Дефект набора <<коридор>> (пример
      взят из \cite{Milchin-2003})}\label{fig:make-up:corridor}}
  \hfill
  \parbox{0.38\textwidth}{\caption{Переполненная строка в
      \textprog{xdvi} при включённой опции
      \textopt{draft}}\label{fig:make-up-draft}}
  \hfill
\end{figure}


\subsection{Строка}
\label{sec:make-up:lines}
Когда строка с точки зрения \TeX{} становится слишком разряженной
(Undefull) или слишком сжатой (Overfull), то в log-файле появляются
предупреждения, начинающиеся со слов вида:
\begin{lstlisting}[language=Clean]
Overfull \hbox (26.2pt too wide) in paragraph at lines 47--56
[][]\T2A/cmr/m/n/12 Список вос-при-ни-ма-е-мых па-ке-том 
оп-ций очень об-ши-рен. В до-ку-мен-та-ции geometry.pdf

\end{lstlisting}

Если при выборе класса документа передать ему опцию \textopt{draft}:
\begin{lstlisting}[]
|\bs|documentclass[draft,a4paper,12pt,oneside]{scrbook} 

\end{lstlisting}
то такие проблемные места будут отмечаться в результирующем
документе. На~рисунке~\ref{fig:make-up-draft} приведён пример такой
отметки.

Обычно подобные переполнения связаны с тем, что \LaTeX{} не знает, как
перенести какое-либо слово. В этом случае следует обучить его, что и
где можно переносить, как это было показано в главе~\ref{cha:base}. В
крайнем случае можно насильно разорвать строку с помощью команды
\textcmd{linebreak} или \lstinline!\\!. В отличие от
\textcmd{linebreak} команда \lstinline!\\! не заставляет остаток
строки выравниваться по правому полю.

Если можно редактировать текст, то для исправления дефектов набора
лучше переделать предложение так, чтобы в новой инкарнации текст не
создавал проблем для чтения.


\Note Пакет \textpkg{microtype} (микротипографика) позволяет
улучшить качество плотного набора за счёт изменения межбуквенных
расстояний. Пакет работает только совместно с \textprog{pdflatex}, так
как является интерфейсом к одному из реализованных в~этом пакете
расширений к стандартному \TeX{}. Пакет также не работает со~шрифтами
в \textcodepage{T2A}, то есть с кириллицей в частности. Автор осознаёт
эту проблему и будет благодарен за любую помощь. Подробности в
\textfile{microtype.pdf}. \mindex{микротипографика}

\subsection{Горизонтальные пробелы}
\label{sec:make-up:hspace}
\mindex{пробелы|(}

Расстояние между словами можно изменить с помощью горизонтальных
промежутков. Горизонтальные промежутки создаются с помощью команды
\textcmd{hspace}. В качестве параметра команде передаётся
длина. Существует также $*$"=вариант команды
\textcmd{hspace$*$}, который отличается от основной тем, что создание
пробела не игнорируется даже тогда, когда пробел приходится на начало
или конец строки.

Существует несколько определённых по умолчанию горизонтальных пробелов:
\begin{eqlist*}
\item[\textcmd{quad}] "--- горизонтальный промежуток шириной 1em.
  Также есть \textcmd{qquad} "--- удвоенный \textcmd{quad}, и 
\textcmd{endspace} "--- половина от \textcmd{quad}.
\item[\textcmd{hfill}] "--- бесконечный горизонтальный
  промежуток. Два \textcmd{hfill} подряд в два раза больше, чем
  один. Также есть более <<маленькая>> бесконечность "---
  \textcmd{hfil}.
\longitem[\textcmd{hrulefill}] "--- то же, что и \textcmd{hfill}, но
  заполненный промежуток подчёркивается. Есть аналогичная  команда
  \textcmd{dotfill}, которая заполняет всё точками.
\end{eqlist*}

\mindex{пробелы|)}



\subsection{Форматирование параграфа}
\label{sec:base2:paragraph}
\mindex{абзац}
\mindex{параграф}

Обычно каждый параграф начинается с красной строки. Для её
подавления служит команда \textcmd{noindent}. Противоположной для неё
по смыслу является команда \textcmd{indent}.

Для целей позиционирования текста в \LaTeX{} предусмотрено три
стандартных окружения: \textenv{center} (центрирование текста),
\textenv{flushleft} (выравнивание по левому краю) и
\textenv{flushright}  (выравнивание по правому краю). Каждому из этих окружений соответствуют
одноимённые декларации. \textcmdh{flushleft} \textcmdh{flushright}
\medskip

\begin{examplenv}[0.5\textwidth]{base2-paragraph-1}
\begin{center}
 Выравниваемся по центру.
\end{center}
\flushleft А теперь по левом краю.
\flushright А теперь по правому.
\end{examplenv}
\medskip

Упомянутые команды центрирования формируют абзац и вставляют
вертикальный пробел перед ним. Пробел перед абзацем не всегда нужен,
поэтому есть соответствующие команды, которые также выравнивают
текст, но пробел не добавляют: \textcmd{centering} (выравнивание по
центру), \textcmd{raggedright}\footnote{\textcmd{raggedright}
  соответствует \textcmd{flushleft} и дословно можно перевести как
  неровный справа.} (по левому краю) и \textcmd{raggedleft} (по
правому краю).

Перечисленные стандартные способы выравнивания текста обладают одним
неприятным свойством "--- при использовании этих механизмов
отключаются переносы. Пакет \textpkg{ragged2e} определяет макрос
\textcmd{RaggedRight}, который обходит эту проблему и позволяет
выравнивать по левому краю без отключения переносов:
\bigskip

\begin{examplenv}[0.5\textwidth]{base2-paragraph-2}
\begin{minipage}[t]{0.48\textwidth}
 \raggedright Длинное предложение 
 должно переноситься нормально
\end{minipage}\rule[-1.8cm]{0.4pt}{2cm}
\begin{minipage}[t]{0.48\textwidth}
 \RaggedRight Длинное предложение 
 должно переноситься нормально.
\end{minipage}
\end{examplenv}
\bigskip

Из примера видно что там, где была применена процедура
\textcmd{RaggedRight}, колонка получилась более компактной.




\subsection{Страница}
\label{sec:make-up:page}

\mindex{страница} 

Проблемы с вёрсткой могут возникнуть и при формировании страниц. В
крайнем случае всегда можно воспользоваться командами принудительного
завершения страницы \textcmd{newpage} или
\textcmd{pagebreak}. \textcmd{newpage} просто завершает страницу, а
при выполнении \textcmd{pagebreak} после формирования страницы полоса
выравнивается по нижней кромке "--- это может привести к
неоправданному растяжению страницы.

Если проблему вёрстки можно решить путём увеличения/уменьшения страницы на
одну-две строки, то лучше воспользоваться следующими макросами:
\begin{lstlisting}[]
\newcommand{\longpage}{\enlargethispage{\baselineskip}}
\newcommand{\shortpage}{\enlargethispage{-\baselineskip}}

\end{lstlisting}

Команда \textcmd{longpage} увеличивает тело текста текущей страницы
на одну строку, а \textcmd{shortpage}, соответственно,
уменьшает. Длина \textcmd{baselineskip} служит для определения
\emph{интерлиньяжа} или междустрочного пробела.


\subsection{Висячая строка}
\label{sec:make-up:widows} 
\mindex{висячая строка}

Одним из самых неприятных дефектов набора является <<висячая
строка>>. Висячая строка "--- это концевая строка абзаца, стоящая
первой на странице, или начальная срока абзаца, стоящая на странице
последней. Таких артефактов следует всячески избегать. Для подавления
этого эффекта в заголовке документа следует переопределить две
переменные:
\begin{lstlisting}[]
\clubpenalty=10000 
\widowpenalty=10000

\end{lstlisting}



\subsection{Вертикальные просветы}
\label{sec:make-up:vspace}

\fxnote{добавить про \bs\bs[2mm]}
\mindex{пробелы!вертикальные|(}

По аналогии с командой \textcmd{hspace}\lstinline!{длина}!
вертикальные промежутки создаются с помощью команды
\textcmd{vspace}\lstinline!{длина}!. Модификация команды
\textcmd{vspace$*$}\lstinline!{длина}! организует вертикальный просвет,
который не игнорируется, даже если просвет попадает на начало или конец
страницы.

Вертикальные просветы также имеют предопределённые команды:
\begin{eqlist}
\longitem[\textcmd{bigskip}] "--- вертикальный промежуток, равный
  примерно \textcmd{baselineskip}. Существуют
  \textcmd{medskip} "--- половина от \textcmd{bigskip} и
  \textcmd{smallskip} "--- $1/4$ от \textcmd{bigskip}.
\item[\textcmd{vfill}] "--- бесконечный вертикальный
  промежуток. Два \textcmd{vfill} подряд в два раза больше, чем
  один. Также есть более <<маленькая>> бесконечность "---
  \textcmd{vfil}.
\end{eqlist}

\mindex{пробелы!вертикальные|)}

%\fxnote{упомянуть в разделе про списки стр 332 от Роженко}
% \FullVersion\textpkg{nccparskip} из пакета \textpkg{ncctools} "---
% управление вертикальными промежутками между абзацами и устранение
% избыточных вертикальных отступов в списках.


\subsection{Печать через две строки}
\label{sec:make-up:2lines}

%\fxnote{смотреть стр 107 путеводителя 2}

%\fxnote{Здесь были проблемы с установкой интервала в 2.5 - получалось
%  меньше - проверить}

До сих пор временами встречаются требования вида: <<Предоставить
диплом, напечатанный через два интервала>> "--- пережиток эпохи
печатных машинок. Для~решения этой проблемы лучше всего
воспользоваться пакетом \textpkg{setspace}. В пакете определена команда
\textcmd{doublespacing}, которая выполняет искомое действие. 

В \textpkg{setspace} определены макросы
\textcmd{onehalfspacing} и \textcmd{singlespacing} "--- печать через
полтора и один интервал соответственно. Для вертикальной разрядки
небольшого фрагмента текста лучше воспользоваться одноимёнными
окружениями или окружением \textenv{spacing}: 
\textenvh{onehalfspacing}\textenvh{singlespacing}
\begin{examplenv}[0.5\textwidth]{spacing}
\begin{spacing}{2.5}
  <<Этот текст напечатан с 
  интервалом в две с 
  половиной строки>>.
\end{spacing}
\end{examplenv}
В качестве основного параметра окружению \textenv{spacing} передаётся
число строк, через которое следует печатать текст.




\section{Многоколоночная вёрстка}
\label{sec:make-up:multicolumn}

Стандартные классы воспринимают при инициализации
опцию \textopt{twocolumn}:
\begin{lstlisting}[]
\documentclass[a4paper,12pt,twocolumn]{scrartcl}   
\end{lstlisting}

На рис.~\ref{fig:make-up:twocolumn} приведён пример действия этой
опции. К двухколоночной печати можно перейти и по ходу текста с
помощью команды \textcmd{twocolumn}\lstinline![заголовок]!. При~этом
совершается переход на следующую страницу, выводится заголовок, если
он есть, а затем весь последующий текст формируется в две колонки. 
Для~перехода в одноколоночный режим следует воспользоваться командой
\textcmd{onecolumn}, при~этом опять сначала происходит переход на
следующую страницу.  Стандартными средствами совместить на одной
странице две и одну колонки нельзя. Для~этого следует воспользоваться
специальными пакетами.

\begin{figure}[p]
  \fbox{\includegraphics[clip,width=0.45\linewidth]{make-up/make-up-twocolumn.eps}}\hfill
  \fbox{\includegraphics[clip,width=0.45\linewidth]{make-up/make-up-twocolumn-2.eps}}

  \parbox[t]{0.45\linewidth}{\caption{Действие опции
      \textopt{twocolumn}, колонки не
      сбалансированы}\label{fig:make-up:twocolumn}}\hfill
  \parbox[t]{0.45\linewidth}{\caption{Колонки сбалансированы с~помощью
      пакета \textpkg{balanced}, а подстрочное примечание сформировано
      с помощью стиля
      \textpkg{ftnright}}\label{fig:make-up:twocolumn-balanced}}
  \bigskip

  \fbox{\includegraphics[clip,width=0.45\linewidth]{make-up/make-up-twocolumn-3.eps}}\hfill
  \fbox{\includegraphics[clip,width=0.45\linewidth]{make-up/make-up-multicol.eps}}

  \parbox[t]{0.45\linewidth}{\caption{Колонки сбалансированы с помощью
      стиля \textpkg{flushend}: вставка в центре осуществляется с
      помощью окружения \textenv{strip}, определённого в стиле
      \textpkg{cuted}}\label{fig:make-up:twocolumn-cuted}}\hfill
  \parbox[t]{0.45\linewidth}{\caption{Пакет \textpkg{multicol}: весь
      текст заключён в окружение \textenv{multicols} с~параметром
      \textopt{2}}\label{fig:make-up:multicol}}
\end{figure}

Обычный двухколоночный режим имеет массу недостатков, в частности, как
видно из рис.~\ref{fig:make-up:twocolumn}, по умолчанию на последней
странице колонки не сбалансированы. Стиль \textpkg{balance} из пакета
\textpkg{preprint} исправляет эту ошибку. Результат представлен на
рис.~\ref{fig:make-up:twocolumn-balanced}. Для этого необходимо
загрузить пакет и активировать балансировку командой
\textcmd{balance}.  

Иногда удобно все сноски со страницы разметить в конце правой колонки,
как на рис.~\ref{fig:make-up:twocolumn-balanced}. Для этого достаточно
воспользоваться стилем \textpkg{ftnright} из пакета
\textpkg{tools}. При этом  знак сноски помещается сразу в
строке, а разделительная линия отсутствует. Подробности можно найти в
файле \textfile{ftnright.pdf}
\smallskip

\Note{} В пакете \textpkg{fixltx2e} исправлено некоторое количество
неприятностей, связанных с двухколоночной вёрсткой. В частности
исправлена ошибка формирования колонтитулов (по умолчанию колонтитул
определяется второй колонкой, а не первой) и решена проблема нумерации
иллюстраций, когда широкая иллюстрация оказывалась позади
одноколоночной. Надо только загрузить его.


\subsubsection{sttools}
\label{sec:make-up:sttools}



Пакет \textpkg{sttools} специализируется на решении проблем, возникающих при
стандартной двухколоночной вёрстке. К сожалению, пакет довольно стар и
давно не обновлялся, хотя явно следовало бы.

При загрузке стиля \textpkg{flushend} включается правильная
балансировка колонок, которую при желании можно отключить с помощью
команды \textcmd{raggedend} и вернуть обратно с помощью команды
\textcmd{flushend}.

Стиль \textpkg{cuted} определяет окружение \textenv{strip}, которое
позволяет перейти к одноколоночной вёрстке, а затем вернуться обратно
без перехода на другую страницу. Пример действия окружения
\textenv{strip} показан на рис.~\ref{fig:make-up:twocolumn-cuted}. При
определении окружения обратите внимание, что между предыдущим и
последующим параграфами и самим окружением должны присутствовать
пустые строки.

Все остальные подробности об этом пакете можно найти в файле
\textfile{presfull.pdf}.


\subsubsection{multicol}
\label{sec:make-up:multicol}

Стандартный стиль \textpkg{multicol} из пакета \textpkg{tools} в
отличие от стандартной двухколоночной вёрстки позволяет совмещать на
одной странице многоколоночную и одноколоночную вёрстку. Также
балансировка колонок на последней странице производится автоматически
и можно задать до десяти текстовых колонок. 

В пакете определено окружение \textenv{multicols}:
\begin{example}[0.4\textwidth]{make-up-multicol-1}
\begin{multicols}{3}
  [\section*{Экскурсия}]
\RaggedRight
Стою на проходной. Жду. 

Объявились позавчера, сказали, 
что хотят. Это уже известная
нам 86-ая школа из города "--- 
там хороший преподаватель 
физики. 
\end{multicols}
\end{example}
\Note{} Если колонки слишком узкие, то имеет смысл выравнивать только по
левому краю, а не по обоим, что и делает в этом примере команда
\textcmd{RaggedRight} (подробности в разделе~\ref{sec:base2:paragraph}
на стр.~\pageref{sec:base2:paragraph}).

В качестве обязательного параметра окружению \textenv{multicols}
передаётся число колонок. Первый необязательный параметр принимает
команды, которые исполняются непосредственно перед началом
многоколоночной вёрстки. Эти команды исполняются в одноколоночном
режиме, что позволяет эффективно совмещать одноколоночный и
многоколоночные режимы.

Если по какой-то причине какую-либо колонку необходимо оборвать и в
то же время продолжить следующие, то для этого в пакете \textpkg{multicol}
определена команда \textcmd{columnbreak}.

Плавающие объекты внутри окружения \textenv{multicols}  поддерживаются
лишь частично. Они могут возникать либо в верхней, либо в нижней части
страницы, иными словами для картинок и таблиц действуют только опции
\textopt{t} и \textopt{b}.  При этом они оформляются так же, как и в
случае одноколоночного режима. Подстрочные примечания 
формируются как при одноколоночной вёрстке. Все особенности
использования пакета описаны в файле \textfile{multicol.pdf}.




\subsubsection{parallel}
\label{sec:make-up:parallel}

Пакет \textpkg{parallel} используется для параллельной печати
текстов. В пакете определено окружение \textenv{Parallel}:
\begin{lstlisting}
\begin{Parallel}{0.4\textwidth}{0.5\textwidth}
 \ParallelLText{First they ignore you, then they laugh at you, 
   then they fight you, then you win.}
 \ParallelRText{Сначала они тебя не замечают, потом смеются 
   над тобой, затем борются с тобой. А потом ты побеждаешь.}
\end{Parallel}
\end{lstlisting}

Результат от исполнения кода представлен ниже:\medskip

\begin{Parallel}{0.4\textwidth}{0.5\textwidth}
  \ParallelLText{First they ignore you, then they laugh at you, then
    they fight you, then you win.}
  \ParallelRText{Сначала они тебя не замечают, потом смеются 
    над тобой, затем борются с тобой. А потом ты побеждаешь.}
\end{Parallel}\medskip

Первый обязательный параметр соответствует ширине левой колонки, а
второй "--- правой. Команда \textcmd{ParallelLText} формирует левую
колонку текста, а комплементарная ей \textcmd{ParallelRText},
соответственно, правую. Для выяснения более подробной информации
следует обратиться к описанию \textfile{parallel.pdf}



% \section{Послесловие}
% \label{sec:make-up:afterwords}
%\smallskip




\endinput

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "../ctex"
%%% End: 
