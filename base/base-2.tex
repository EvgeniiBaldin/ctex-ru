%  -*- coding: koi8-r -*-
\chapter{Базовые навыки}
\label{cha:base2}

{\setlength{\epigraphwidth}{0.55\textwidth} \epigraph{Ставим единицу в
    том месте, где должна быть краска, и нуль в том, где её быть не
    должно "--- и можно печатать книжную страницу!}{\emph{Дональд Э.\,Кнут}}}


Собранная в этой главе информация может помочь при наборе и
формировании структуры текста.  Прежде чем приступить к изучению, имеет
смысл просмотреть главу~\ref{cha:base} <<Базовые элементы>> на
странице~\pageref{cha:base}.

\section{Интернационализация и локализация}
\label{sec:base2:i18n}
\mindex{русификация}
\mindex{локализация|(}
\mindex{интернационализация|(}

Основным инструментом в деле интернационализации и локализации
является пакет \textpkgemph{babel}. Он не просто включает поддержку
переносов, но и локализует стандартные заголовки, типа <<Оглавление>>,
<<Список литературы>>, <<Приложение>> и~тому подобное. Для выбора
языков документа их следует указать как опцию при загрузке
\textpkgemph{babel}:
\begin{lstlisting}[]
\usepackage[english,russian]{babel}
\end{lstlisting}

Основным языком станет последний язык  из перечисленных в списке. 

Пакет поддерживает сорок три  языка без учёта диалектов: африкаанс
(afri\-ka\-ans), английский (english,
USenglish, american, UKenglish,
british, canadian, au\-stra\-lian,
newzealand), баскский (basque), болгарский
(bulgarian), бретонский (breton), венгерский
(magyar), (hungarian), верхнелужицкий
(up\-per\-sor\-bian), галисийский (galician),
голландский (dutch), греческий (greek,
polutonikogreek), датский (da\-nish), еврейский
(hebrew), интерлингва (interlingua), ирландский
(irish), исландский (icelandic), испанский
(spanish), итальянский (italian), каталанский
(catalan), латинский (latin), малайский
(bahasa), немецкий (austrian, ger\-man,
ger\-manb, nger\-man, naustrian),
нижнелужицкий (lowersorbian), норвежский (norsk),
(nynorsk), польский (polish), португальский
(portuges, portuguese, brazilian),
 русский (rus\-si\-an), румынский
(romanian), северносаамский (samin), сербский
(ser\-bi\-an), словацкий (slovak), словенский
(slovene), турецкий (turkish), украинский
(ukra\-in\-ian), уэльский (welsh), финский
(finnish), французский (french,
francais, canadien, acadian), хорватский
(croatian), чешский (czech), шведский
(swedish), шотландский (scottish), эсперанто
(esperanto) и эстонский (estonian).

Для смены языка в тексте можно воспользоваться декларацией
\textcmdemph{selectlanguage}: 
\medskip

\begin{examplenv}[0.55\textwidth]{base2-babel-1}
{\selectlanguage{english}\chaptername{}}
по-русски "--- это \chaptername.
\end{examplenv}
\medskip

При переключении языка меняются не только правила переносов, но и
вообще всё, за что отвечает \textpkgemph{babel}. В качестве альтернативного
способа переключения языка можно использовать окружение \textenv{otherlanguage}:
\medskip

\begin{examplenv}[0.63\textwidth]{base2-babel-2}
% Русские переносы
Наука "--- это то, что известно достаточно 
хорошо, чтобы объяснить это компьютеру. Всё 
остальное "--- это искусство. Дональд~Кнут\par
% Переключаемся на английский
\begin{otherlanguage}{english}
% Теперь пошли английские переносы
Science is what we understand well enough to 
explain to a computer. Art is everything 
else we do. Donald~Knuth
\end{otherlanguage}
\end{examplenv}
\medskip

Для кратких включений текста на другом языке можно воспользоваться
командой \textcmdemph{foreignlanguage}\lstinline!{язык}{текст}!. Эта
команда меняет только таблицу переносов и специальные символы, присущие
языку, но не локализацию:
\medskip

\begin{examplenv}[0.6\textwidth]{base2-babel-3}
\foreignlanguage{english}{\chaptername{}} "--- 
видно, что локализация не поменялась.
\end{examplenv}
\medskip

Этой команде соответствует окружение \textenv{otherlanguage$*$}.


Следует знать, что при переключении c русского (\textopt{russian}) на
английский язык (\textopt{english}), переключается также и внутренняя
раскладка \TeX{} с \textcodepage{T2A}, в которой определена кириллица,
на \textcodepage{T1}, в которой кириллицы нет, поэтому при включённом
английском языке кириллица не выводится. Для того чтобы обойти эту
проблему, следует воспользоваться реализациями \LaTeX-компилятора,
которые в~качестве внутренней кодировки используют Unicode, например,
\textprog{xelatex}.
\fxnote{вставить ссылку на XeTeX}


\textpkgemph{babel} "--- не просто пакет по выбору языков "--- это конструктор,
позволяющий добавить свой собственный язык и правила. В частности, при
определении своих команд, зависящих от языка текста, может быть полезна
инструкция \textcmdemph{iflanguage}:

\begin{example}[0.7\textwidth]{base2-babel-4}
Здесь\selectlanguage{english}
\iflanguage{russian}{русский}{not russian}.\par
\selectlanguage{russian}
А здесь \iflanguage{russian}{русский}{not russian}.
\end{example}

\Note Загрузка русского языка в пакете \textpkgemph{babel}, к сожалению,
не полностью выставляет правильные умолчания для русской полиграфии. В
частности, для того чтобы первый абзац начинался с красной строки,
необходимо загрузить стиль \textpkg{indentfirst}. Дополнительно
следует загрузить и стиль \textpkg{misccorr} из пакета \textpkg{t2},
который исправляет отдельные недочёты \textpkgemph{babel}.

\mindex{локализация|)}
\mindex{интернационализация|)}

\section{Символы}
\label{sec:base2:symbol}

Набор текста не ограничен только буквами алфавита. Для обозначения
различных понятий человечество постоянно придумывает новые
значки. Наиболее полным источником информации о доступных в \LaTeX{}
символах является текст <<The Comprehensive LATEX Symbol List>>. Всё
что нужно "--- это открыть pdf"=файл  \textfile{symbols-a4.pdf} и
найти нужный символ.

\begin{center}
  \begin{longtable}{SclScl}\hline
    \multicolumn{4}{c}{\cbox{Символы, определённые в текстовой моде}}\\\hline
    \textasciicircum&\textcmd{textasciicircum}&
    \textasciitilde&\textcmd{textasciitilde}\\
    \textasteriskcentered&\textcmd{textasteriskcentered}&
    \textbackslash&\textcmd{textbackslash}\\
    \textbar&\textcmd{textbar}&
    \textbraceleft&\textcmd{textbraceleft}\\
    \textbraceright&\textcmd{textbraceright}&
    \textbullet&\textcmd{textbullet}\\
%    \textcopyright&\textcmd{textcopyright}&
    \textdagger&\textcmd{textdagger}&
    \textdaggerdbl&\textcmd{textdaggerdbl}\\
    \textdollar&\textcmd{textdollar}&
    \textellipsis&\textcmd{textellipsis}\\
    \textemdash&\textcmd{textemdash}&
    \textendash&\textcmd{textendash}\\
    \textexclamdown&\textcmd{textexclamdown}&
    \textgreater&\textcmd{textgreater}\\
    \textless&\textcmd{textless}&
    \textordfeminine&\textcmd{textordfeminine}\\
     \textordmasculine&\textcmd{textordmasculine}&
     \textparagraph&\textcmd{textparagraph}\\
     \textperiodcentered&\textcmd{textperiodcentered}&
     \textquestiondown&\textcmd{textquestiondown}\\
     \textquotedblleft&\textcmd{textquotedblleft}&
     \textquotedblright&\textcmd{textquotedblright}\\
    \textquoteleft&\textcmd{textquoteleft}&
    \textquoteright&\textcmd{textquoteright}\\
    \textregistered&\textcmd{textregistered}&
    \textsection&\textcmd{textsection}\\
    \textsterling&\textcmd{textsterling}&
    \texttrademark&\textcmd{texttrademark}\\
    \textunderscore&\textcmd{textunderscore}&
    \textvisiblespace&\textcmd{textvisiblespace}\\
    \hline
  \end{longtable}
\end{center}
\begin{center}
  \begin{longtable}{SclScl}\hline
    \multicolumn{4}{c}{\cbox{Дополнительные символы (\textpkg{textcomp})}}\\\hline
    \textasteriskcentered&\textcmd{textasteriskcentered}&
    \textbardbl&\textcmd{textbardbl}\\
    \textbigcircle&\textcmd{textbigcircle}&
    \textblank&\textcmd{textblank}\\
    \textbrokenbar&\textcmd{textbrokenbar}&
    \textbullet&\textcmd{textbullet}\\
    \textdagger&\textcmd{textdagger}&
    \textdaggerdbl&\textcmd{textdaggerdbl}\\
    \textdblhyphen&\textcmd{textdblhyphen}&
    \textdblhyphenchar&\textcmd{textdblhyphenchar}\\
    \textdiscount&\textcmd{textdiscount}&
    \textestimated&\textcmd{textestimated}\\
    \textinterrobang&\textcmd{textinterrobang}&
    \textinterrobangdown&\textcmd{textinterrobangdown}\\
    \textmusicalnote&\textcmd{textmusicalnote}&
    \textnumero&\textcmd{textnumero}\\
    \textopenbullet&\textcmd{textopenbullet}&
    \textordfeminine&\textcmd{textordfeminine}\\
    \textordmasculine&\textcmd{textordmasculine}&
    \textparagraph&\textcmd{textparagraph}\\
    \textperiodcentered&\textcmd{textperiodcentered}&
    \textpertenthousand&\textcmd{textpertenthousand}\\
    \textperthousand&\textcmd{textperthousand}&
    \textpilcrow&\textcmd{textpilcrow}\\
    \textquotesingle&\textcmd{textquotesingle}&
    \textquotestraightbase&\textcmd{textquotestraightbase}\\
    \textquotestraightdblbase&\textcmd{textquotestraightdblbase}&
    \textrecipe&\textcmd{textrecipe}\\
    \textreferencemark&\textcmd{textreferencemark}&
    \textsection&\textcmd{textsection}\\
    \textthreequartersemdash&\textcmd{textthreequartersemdash}&
    \texttildelow&\textcmd{texttildelow}\\
    \texttwelveudash&\textcmd{texttwelveudash}&
    &\\\hline
    \multicolumn{4}{c}{\cbox{Стрелки в текстовой моде (\textpkg{textcomp})}}\\\hline
    \textdownarrow&\textcmd{textdownarrow}&
    \textleftarrow&\textcmd{textleftarrow}\\
    \textrightarrow&\textcmd{textrightarrow}&
    \textuparrow&\textcmd{textuparrow}\\\hline
%     \multicolumn{4}{c}{Скобки в текстовой моде (\textpkg{textcomp})}\\\hline
%     \textlangle&\textcmd{textlangle}&
%     \textlbrackdbl&\textcmd{textlbrackdbl}\\
%     \textlquill&\textcmd{textlquill}&
%     \textrangle&\textcmd{textrangle}\\
%     \textrbrackdbl&\textcmd{textrbrackdbl}&
%     \textrquill&\textcmd{textrquill}\\\hline
     \multicolumn{4}{c}{\cbox{Дополнительные символы (\textpkg{wasysym})}}\\\hline
%      \davidsstar&\textcmd{davidsstar}&
      \hexstar&\textcmd{hexstar}&
      \varhexstar&\textcmd{varhexstar}\\
     \ataribox&\textcmd{ataribox}&
     \bell&\textcmd{bell}\\
     \blacksmiley&\textcmd{blacksmiley}&
     \Bowtie&\textcmd{Bowtie}\\
     \brokenvert&\textcmd{brokenvert}&
     \checked&\textcmd{checked}\\
     \CheckedBox&\textcmd{CheckedBox}&
     \clock&\textcmd{clock}\\
     \diameter&\textcmd{diameter}&
     \DOWNarrow&\textcmd{DOWNarrow}\\
     \frownie&\textcmd{frownie}&
     \invdiameter&\textcmd{invdiameter}\\
     \kreuz&\textcmd{kreuz}&
     \LEFTarrow&\textcmd{LEFTarrow}\\
     \lightning&\textcmd{lightning}&
     \permil&\textcmd{permil}\\
     \phone&\textcmd{phone}&
     \pointer&\textcmd{pointer}\\
     \recorder&\textcmd{recorder}&
     \RIGHTarrow&\textcmd{RIGHTarrow}\\
     \smiley&\textcmd{smiley}&
     \Square&\textcmd{Square}\\
     \sun&\textcmd{sun}&
     \UParrow&\textcmd{UParrow}\\
     \wasylozenge&\textcmd{wasylozenge}&
     \XBox&\textcmd{XBox}\\\hline
  \end{longtable}
\end{center}

\newpage

\begin{center}
  \begin{longtable}{SclSclSclSclScl}\hline
    \multicolumn{10}{c}{\cbox{Символы, определённые и для текстовой и для
      математической моды}}\\\hline
    \$&\textcmde{\$} &
    \}&\textcmde{\}}&
    \{&\textcmde{\}}&
    \dag&\textcmd{dag}&
    \ddag&\textcmd{ddag}\\
    \dots&\textcmd{dots}&
    \P&\textcmd{P}&
    \pounds&\textcmd{pounds}&&&&\\\hline
    \multicolumn{10}{c}{\cbox{Дополнительные символы из пакета \textpkg{amssymb}}}\\\hline
    \checkmark&\textcmd{checkmark}&
    \circledR&\textcmd{circledR}&
    \maltese&\textcmd{maltese}&&&&\\\hline
    \multicolumn{10}{c}{\cbox{Не ASCII-символы}}\\\hline
    \aa&\textcmd{aa}&
    \AA&\textcmd{AA}&
    \AE&\textcmd{AE}&
    \ae&\textcmd{ae}&
    \DJ&\textcmd{DJ}\\
    \dj&\textcmd{dj}&
    \L&\textcmd{L}&
    \l&\textcmd{l}&
    \o&\textcmd{o}&
    \O&\textcmd{O}\\
    \OE&\textcmd{OE}&
    \oe&\textcmd{oe}&
    \ss&\textcmd{ss}&
    \S&\textcmd{S}&
    \SS&\textcmd{SS}\\\hline
  \end{longtable}
\end{center}



\subsection{Валютные символы}
\label{sec:base-2:currency}

\mindex{евро}

\begin{center}
  \begin{longtable}{SclSclScl}\hline
    \multicolumn{6}{c}{\cbox{Валютные знаки (\textpkg{textcomp})}}\\\hline
    \textbaht&\textcmd{textbaht}&
    \textcent&\textcmd{textcent}&
    \textcentoldstyle&\textcmd{textcentoldstyle}\\
    \textcolonmonetary&\textcmd{textcolonmonetary}&
    \textcurrency&\textcmd{textcurrency}&
    \textdollar&\textcmd{textdollar}\\
    \textdollaroldstyle&\textcmd{textdollaroldstyle}&
    \textdong&\textcmd{textdong}&
    \texteuro&\textcmd{texteuro}\\
    \textflorin&\textcmd{textflorin}&
    \textguarani&\textcmd{textguarani}&
    \textlira&\textcmd{textlira}\\
    \textnaira&\textcmd{textnaira}&
    \textpeso&\textcmd{textpeso}&
    \textsterling&\textcmd{textsterling}\\
    \textwon&\textcmd{textwon}&
    \textyen&\textcmd{textyen}&
    & \\\hline
    \multicolumn{6}{c}{\cbox{Дополнительные символы валют (\textpkg{wasysym})}}\\\hline
    \cent&\textcmd{cent}&
    \currency&\textcmd{currency}&
    &\\\hline
    \multicolumn{6}{c}{\cbox{Знаки евро (\textpkg{eurosym})}}\\\hline
    \geneuro&\textcmd{geneuro}&
    \geneuronarrow&\textcmd{geneuronarrow}&
    \geneurowide&\textcmd{geneurowide}\\
    \officialeuro&\textcmd{officialeuro}&
    &&
    &\\\hline
  \end{longtable}
\end{center}

\subsection{Копирайт и копилефт}
\label{sec:base-2:copyrite}

\mindex{копилефт}
\mindex{копирайт}

\begin{center}
  \begin{longtable}{SclSclScl}\hline
    \multicolumn{6}{c}{\cbox{Знаки копирайта и копилефта (\textpkg{textcomp})}}\\\hline
    \textcircledP&\textcmd{textcircledP}&
    \textcopyleft&\textcmd{textcopyleft}&
    \textcopyright&\textcmd{textcopyright}\\
    \textregistered&\textcmd{textregistered}&
    \textservicemark&\textcmd{textservicemark}&
    \texttrademark&\textcmd{texttrademark}\\\hline
  \end{longtable}
\end{center}


\subsection{Акценты}
\label{sec:base-2:acents}

\mindex{акценты|(}
В пакете \textpkg{textcomp} определена команда \textcmd{newtie},
которая добавляет округлую крышечку над буквой (\newtie{A}\newtie{a}).
Чтобы заключить букву в круг, можно воспользоваться командой
\textcmd{textcircled} (\textcircled{A}\textcircled{a}).

\begin{center}
  \begin{longtable}{SclSclSclScl}\hline
    \multicolumn{8}{c}{\cbox{Акценты в текстовой моде}}\\\hline
    \"{A}\"{a}&\lstinline!\"{A}!\lstinline!\"{a}!&
    \`{A}\`{a}&\lstinline!\`{A}!\lstinline!\`{a}!&
    \.{A}\.{a}&\lstinline!\.{A}!\lstinline!\.{a}!&
    \={A}\={a}&\lstinline!\={A}!\lstinline!\={a}!\\
    \^{A}\^{a}&\lstinline!\^{A}!\lstinline!\^{a}!&
    \'{A}\'{a}&\lstinline!\'{A}!\lstinline!\'{a}!&
    \~{A}\~{a}&\lstinline!\~{A}!\lstinline!\~{a}!&
    \b{A}\b{a}&\lstinline!\b{A}!\lstinline!\b{a}!\\
    \c{A}\c{a}&\lstinline!\c{A}!\lstinline!\c{a}!&
    \d{A}\d{a}&\lstinline!\d{A}!\lstinline!\d{a}!&
    \k{A}\k{a}&\lstinline!\k{A}!\lstinline!\k{a}!&
    \r{A}\r{a}&\lstinline!\r{A}!\lstinline!\r{a}!\\
    \t{A}\t{a}&\lstinline!\t{A}!\lstinline!\t{a}!&
    \u{A}\u{a}&\lstinline!\u{A}!\lstinline!\u{a}!&
    \U{A}\U{a}&\lstinline!\U{A}!\lstinline!\U{a}!&
    \v{A}\v{a}&\lstinline!\v{A}!\lstinline!\v{a}!\\\hline
  \end{longtable}
\end{center}


\mindex{акценты|)}


% \hexagon  \octagon \pentagon \varhexagon

% \CIRCLE \LEFTcircle \RIGHTcircle \rightturn
% \Circle \Leftcircle \Rightcircle
% \LEFTCIRCLE \RIGHTCIRCLE \leftturn








% Table 34: cclicenses Creative Commons License Icons
% \cc\ccby\ccnc\ccnd\ccsa


\section{К вопросу о шрифтах}
\label{sec:base2:font}


Говорить, что кириллических шрифтов нет совсем, было бы
неправильно. Они есть, но их \emph{очень} мало.

\mindex{шрифты!Computer Modern|(}
Если не рассматривать коммерческие шрифты, то при использовании
\LaTeX{} наиболее предпочтительнее шрифты семейства Computer Modern,
которые доступны в формате Type1 в рамках пакета
\textpkg{cm-super}. Эти шрифты используются в дистрибутиве \TeXLive{}
по умолчанию. Кириллица в семейство Computer Modern была добавлена
усилиями Ольги Лапко (пакет \textpkg{lh}).

Шрифты семейства Computer Modern имеют все необходимые начертания
(\textit{курсив}, \textbf{жир\-ный текст}, \textsc{Капитель} и 
\textsl{наклонный шрифт}) и хорошо согласуются с~математическими
символами (рис.~\ref{fig:base-2:cm-super}). 
\mindex{шрифты!Computer Modern|)}

\mindex{шрифты!Concrete|(}\mindex{шрифты!Euler}
Альтернативой шрифтам Computer Modern может служить семейство
Concrete. Это семейство было создано Д.\,Э.~Кнутом из шрифтов Computer
Modern и хорошо согласуется с математическими символами Euler Германа
Цапфа. Для использования этих шрифтов достаточно загрузить в преамбуле
стиль \textpkg{concrete} (рис.~\ref{fig:base-2:concrete}).
\mindex{шрифты!Concrete|)}

% \Note При использовании шрифтов Euler нельзя загружать
% стиль \textpkg{mathtext}, который позволяет использовать кириллицу в
% формулах. В любом случае для кириллицы в формулах лучше использовать
% команду \textcmd{text} из пакета \textpkg{amsmath}.

\mindex{шрифты!Antykwa Tor\'unska|(}
В шрифтах Antykwa Tor\'unska также есть кириллица. Для 
инициализации следует загрузить стиль \textpkg{anttor}
(рис.~\ref{fig:base-2:anttor}). Вероятно, эти шрифты будут лучше
сочетаться с математическими символами Euler, которые можно загрузить
с помощью стиля \textpkg{euler}.
\mindex{шрифты!Antykwa Tor\'unska|)}

Выбор не богатый, но это лучше, чем ничего. Перечисленные ранее шрифты
доступны в дистрибутиве \TeXLive{} <<из коробки>>. При этом никто не
ограничивает в подключении сторонних шрифтов. Подключение шрифтов
формата Type1 подробно описано в замечательном документе <<The Font Installation
Guide>> (файл \textfile{fontinstallationguide.pdf}).


\begin{figure}[t]
  \centering
  \hfill\includegraphics[width=0.47\textwidth]{base/base-2-cm-super.eps}\hfill
  \includegraphics[width=0.47\textwidth]{base/base-2-concrete.eps}\hfill
  
  \hfill\parbox{0.47\textwidth}{\caption{Шрифт Computer
      Modern}\label{fig:base-2:cm-super}}\hfill
  \parbox{0.47\textwidth}{\caption{Шрифты Concrete и Euler}
    \label{fig:base-2:concrete}}\hfill
  \bigskip

  \includegraphics[width=0.47\textwidth]{base/base-2-anttor.eps}
  \smallskip

  \parbox{0.56\textwidth}{\caption{Шрифты Antykwa Tor\'unska и  Euler (в
    текстовом шрифте отсутствуют <<ёлочки>>)}\label{fig:base-2:anttor}}
\end{figure}


\section{Работа с текстом}
\label{sec:base2:text}

Спокойное течение текста часто хочется прервать восклицанием, цитатой
авторитета или просто списком покупок. 

\subsection{Выделение текста}
\label{sec:base2:emph}

А разделе~\ref{sec:base:nabor} <<Логика набора>> на
стр.~\pageref{sec:base:textemph} рассказано, как выделять текст 
с~помощью смены насыщенности и начертания шрифта. Обычно этого хватает 
с~избытком. Более того, классические методы выделения, такие как
\ul{подчёркивание} и \so{разрядка} пришли из эпохи печатных машинок,
когда ощущалась значительная нехватка средств выразительности. Но в
любом случае иногда бывает нужно даже это, и \LaTeX, естественно,
обладает необходимым функционалом. 

\subsubsection{soul}
\label{sec:base-2:soul}
\mindex{текст в разрядку}

Пакет \textpkgemph{soul} специализируется на различных способах выделения
текста: \textcmdhemph{so}\textcmdhemph{ul}\textcmdhemph{st}
\begin{examplenv}[0.53\textwidth]{base2-emph-1}
Вот так выглядит \so{разрядка}, 
\ul{подчёркивание} и \st{перечёркивание}.
\end{examplenv}
В пакете \textpkgemph{soul} имеется возможность цветового выделения
текста. При использовании команд \textpkgemph{soul} выделенный текст
корректно переносится, внутри команд можно менять шрифт и начертание,
но команды \textpkgemph{soul} нельзя вкладывать друг в друга. Также
имеется ещё некоторый набор ограничений. Для выяснения подробностей
лучше обратиться к документации \textfile{soul.pdf}.

\subsubsection{nccstretch}
\label{sec:base-2:nccstretch}

\mindex{текст в разрядку}

Стиль \textpkgemph{nccstretch} из пакета \textpkg{ncctools} определяет ещё
одну команду для выделения текста \so{разрядкой}:\textcmdhemph{so}
\begin{example}[0.5\textwidth]{base2-emph-2}
\centering
\stretchwith{\,}{АКАДЕМИЯ\ НАУК}
\end{example}
Первый аргумент команды \textcmdemph{stretchwith} принимает символ/набор
символов, который вставляется между буквами, при этом пробелы
игнорируются. 


\subsubsection{Разделительные линии}
\label{sec:base2:hfill}

\mindex{разделительные линии|(}%textbf

Для создания разделительной линии можно использовать команду \textcmdemph{hrule}.
\hrule

Команда \textcmdemph{hrulefill} заполняет оставшееся до конца строки
место: \hrulefill

Команда \textcmdemph{rule}\lstinline![смещение]{ширина}{высота}! формирует
чёрный прямоугольник указанной ширины и высоты:
\medskip

\begin{examplenv}[0.5\textwidth]{base2-rule-1}
\centering\rule{2pt}{1cm}
\rule[0.5cm]{0.2\textwidth}{1pt}
\rule{0.2\textwidth}{1pt}
\rule[-0.5cm]{0.2\textwidth}{1pt}
\rule[-1cm]{2pt}{1cm}
\end{examplenv}
\medskip

Смещение указывается по отношению к базовой линии и может принимать
отрицательные значения. Если ширину или высоту линии указать равной 0
(нулю), то получается невидимая линия. Таким образом можно формировать
подпорки для боксов.

Для создания пунктирной и штрихпунктирной разделительной линии можно
обратиться к стилю \textpkg{dashrule}. Стиль \textpkg{nccrules} из
пакета \textpkg{ncctools} позволяет полностью проконтролировать вид,
длину и ширину разделительной линии.

Для заполнение строки каким-то определённым символьным шаблоном можно
использовать стиль \textpkg{mboxfill} из пакета \textpkg{ncctools}. В
этом стиле определена одноимённая команда \textcmdemph{mboxfill}:
\medskip

\begin{examplenv}[0.5\textwidth]{base2-rule-2}
\mboxfill[1.2\width]{\^{}\_\^{}}
\end{examplenv}
\medskip

В качестве обязательного аргумента команде передаётся шаблон, по
образцу которого
будет заполнятся строка. Первый необязательный параметр принимает
ширину, которая будет отводиться под шаблон. Обычно эта величина больше
ширины шаблона. В качестве ширины шаблона можно использовать макрос
\textcmd{width}.  У команды есть ещё и второй необязательный параметр
для тонкой настройки заливки. Более подробно об этом рассказано в
файле документации \textfile{mboxfill.pdf}.

\mindex{разделительные линии|)}%textbf

\subsection{Боксы}
\label{sec:base2:box}

\TeX{} управляется с боксами. Он сам их нарезает и склеивает, но при
желании можно создать бокс самому.

Самый простой способ создать бокс "--- это команда
\textcmdemph{mbox}\lstinline!{текст}!.  В разделе <<Пунктуация>> на
странице~\pageref{sec:base:punctuation:hyphen} эта команда
использовалась для запрета переноса в слове. \textcmdemph{mbox} не
производит никаких видимых эффектов. \textcmdemph{fbox} же напротив
создаёт рамочку вокруг созданного бокса, а в остальном полностью
эквивалентен \textcmdemph{mbox}. Обе упомянутые команды  автоматически
выставляют размеры
создаваемых боксов. Для задания своих
размеров существуют команды \textcmdemph{makebox} и \textcmdemph{framebox}:
\bigskip

\begin{examplenv}[0.54\textwidth]{base2-mbox-1}
\centering
\framebox[\textwidth][l]{АКАДЕМИЯ\ НАУК}

\framebox[0.5\width][c]{АКАДЕМИЯ\ НАУК}
\end{examplenv}
\bigskip

Первый необязательный параметр "--- это ширина создаваемого бокса,
второй "--- позиция текста внутри бокса. Позиция текста определяется с
помощью одной буквы: \textopt{l} "--- сдвигает текст влево,
\textopt{r} "--- вправо, \textopt{c} "--- размещает по центру,
\textopt{s} "--- растягивает текст за счёт пробелов на всю заявленную
ширину. При указании размеров нового бокса можно использовать
стандартные макросы \textcmd{width} (ширина текста в~аргументе),
\textcmd{totalheight} (полная высота текста), \textcmd{height}
(\emph{высота} текста "--- расстояние от базовой линии до верхней
точки) и \textcmd{depth} (\emph{глубина} текста "--- расстояние от
базовой линии до нижней точки). После определения бокса \LaTeX{}
больше не обращает внимание на границы текста, а смотрит только на размеры.

\mindex{рамка вокруг текста}
Макрос \textcmdemph{shabox}, определённый в  стиле  \textpkgemph{shadow}, может
несколько украсить рамочку бокса:
\bigskip

\begin{examplenv}[0.5\textwidth]{base2-mbox-2}
\centering\shabox{бокс с тенью}
\end{examplenv}
\bigskip

Есть и другие способы <<украшения>> и задания боксов. Некоторые из
пакетов перечислены на стр.~\pageref{sec:catalog:box}.

Для измерения размеров ненапряжённого текста можно воспользоваться
командами:\textcmdh{settowidth}\textcmdh{settoheight}\textcmdh{settodepth}
\begin{lstlisting}
\settowidth{длина}{измеряемый текст}
\settoheight{длина}{измеряемый текст}
\settodepth{длина}{измеряемый текст}

\end{lstlisting}

Здесь длина "--- переменная, которой присваивается измеренное значение
ширины, высоты и глубины текста соответственно.
 
Для создания бокса более чем в одну строку используются окружение
\textenvemph{minipage} или команда \textenvemph{parbox}:
\medskip

\begin{examplenv}[0.5\textwidth]{base2-mbox-3}
\parbox{0.3\textwidth} 
         {Объявление в газете:}\quad
\begin{minipage}{0.62\textwidth}
  Ищу работу машинистки.  Печатаю со 
  скоростью 4 тысячи знаков в минуту.
  Правда, такая белиберда получается!
\end{minipage}
\end{examplenv}
\medskip

Подробнее об этих командах рассказано в разделе <<Упаковка картинок в
один float>> на стр.~\pageref{sec:graphics:float-collect}.






\subsection{Цитаты}
\label{sec:base2:cite}


Традиционно цитаты текста выделяются отступами с обеих сторон
параграфа. Для такого форматирования в \LaTeX{} можно использовать
окружения \textenv{quote} (используется для коротких цитат) и
\textenvemph{quatation} (в отличие от \textenv{quote} печатается с~красной
строки). 

\begin{examplenv}[0.47\textwidth]{base2-paragraph-3}
Описывая  Гекльберри Финна,
Марк Твен писал:
\begin{quotation}
  Кое-что он преувеличивал, но в 
  основном говорил правду.
\end{quotation}
\end{examplenv}

\mindex{эпиграф|(}
Ещё один способ оформить цитату "---  добавление к ней
эпиграфа. Для этого существует специальный пакет, который, как это не
сложно догадаться, так и называется \textpkgemph{epigraph}. Для того чтобы
добавить эпиграф в своё произведение, можно воспользоваться командой:
\textcmdhemph{epigraph}
\begin{lstlisting}[]
\epigraph{|<<текст>>|}{|<<источник>>|}

\end{lstlisting}
где <<текст>> "--- это тело эпиграфа, а <<источник>> "--- тот,
кто ответственен за создание тела. По умолчанию эпиграф помещается
справа. Именно с помощью этой команды сформированы все эпиграфы в этой
книге.

Ширину текста в эпиграфе можно установить с помощью изменения
переменной \textcmd{epigraphwidth} с помощью команды
\textcmd{setlength}, например, так:
\begin{lstlisting}[]
\setlength{\epigraphwidth}{0.3\textwidth}

\end{lstlisting}

Перед началом каждой главы (\textcmd{chapter}) делается значительный пропуск,
чтобы логически обозначить начало новой части. Это пустое место
идеально подходит для вставки эпиграфа. Для этого используется команда 
\textcmdemph{epigraphhead}:
\begin{lstlisting}[]
\chapter*{новая глава}
\epigraphhead[|<<расстояние>>|]{\epigraph{|<<тело>>|}{|<<источник>>|}}

\end{lstlisting}

Необязательный параметр <<расстояние>> представляет число, которое
характеризует отступ в терминах текущего значения переменной
\textcmd{unitlength}. Для главы типичный отступ равен 70. Если эпиграф
слишком большой, то заголовок главы можно чуть опустить с помощью
команды \textcmd{dropchapter}\lstinline!{длина}!.  

Документация вместе с исходниками пакета находится в файле
\textfile{epigraph.dtx}.  \mindex{эпиграф|)}
\vspace*{-2em}
\subsection{Перечни}
\label{sec:base2:list}


Перечни уже были упомянуты в разделе~\ref{sec:base:nabor:itemize} на
стр.~\pageref{sec:base:nabor:itemize}. Существует три основных
окружения для создания перечней:
\smallskip

\begin{eqlist}
\item[\textenvemph{enumerate}] "--- нумерованный список,
\item[\textenvemph{itemize}] "--- ненумерованный  список,
\item[\textenvemph{description}] "--- список без метки по умолчанию.
\end{eqlist}

Внутри окружения пункты перечня разделяются с помощью команды
\textcmd{item}:
\smallskip

\begin{examplenv}{enumerate}
\begin{enumerate}
 \item первый пункт,\label{ex:first}
 \item второй пункт.
\end{enumerate}
В пункте \ref{ex:first}\ldots
\end{examplenv}
\smallskip

В качестве необязательного параметра команде \textcmdemph{item} можно
передать ключевое слово. Обычно ключевое слово передают в случае
окружения \textenvemph{description}, так как оно не имеет ключевого
слова по умолчанию:
\medskip

\begin{examplenv}[0.5\textwidth]{base2-list-1}
\begin{description}
  \item[enumerate] "--- нумерованный,
  \item[itemize] "--- ненумерованный,
  \item[description] "--- без метки.
\end{description}
\end{examplenv}
\medskip


Перечни можно вкладывать друг в друга, создавая вложенные списки. 
При~этом каждый следующий уровень форматируется по своему. Вот так,
например, выглядят разные уровни окружений \textenvemph{enumerate} и
\textenvemph{itemize}:
\begin{enumerate}
\item первый уровень перечня \textenv{enumerate}
  \begin{enumerate}
  \item второй уровень
    \begin{enumerate}
    \item третий уровень
      \begin{enumerate}
      \item четвёртый уровень
      \end{enumerate}
    \end{enumerate}
  \end{enumerate}
\item опять первый уровень \textenv{enumerate}
  \begin{itemize}
  \item второй уровень окружения \textenv{itemize}
    \begin{itemize}
    \item третий уровень
      \begin{itemize}
      \item четвёртый уровень
        \begin{itemize}
        \item пятый уровень
        \end{itemize}
      \end{itemize}
    \end{itemize}
  \end{itemize}
\end{enumerate}

\mindex{русификация!перечни}
Чтобы заставить окружение \textenvemph{enumerate} нумеровать списки
\textcmd{item} по-русски, то после инициализации пакета
\textpkg{babel} следует выполнить команду:
\begin{lstlisting}[]
\renewcommand{\theenumi}{\asbuk{enumi}}
\end{lstlisting}

Это поменяет формат нумерации на верхнем уровне. На следующих уровнях
используются счётчики \textcount{enumii}, \textcount{enumiii},
\textcount{enumiv} по возрастающей. Подробнее про счётчики рассказано в
разделе~\ref{sec:prog:counters} на стр.~\pageref{sec:prog:counters}.




\subsubsection{eqlist}
\label{sec:base-2:eqlist}
Из примера с окружением \textenv{description} видно, что в случае
разных по длине меток текст описания не выравнивается. Это можно
исправить, загрузив пакет \textpkgemph{eqlist}, в котором определяется
одноимённое окружение:
\begin{example}[0.5\textwidth]{base2-list-2}
\begin{eqlist*}
  \item[enumerate] "--- нумерованный,
  \item[itemize] "--- ненумерованный,
  \item[description] "--- без метки.
\end{eqlist*}
\end{example}
Окружения \textenvemph{eqlist} и \textenvemph{eqlist$*$}
отличаются друг от друга тем, что окружение
\textenvemph{eqlist$*$} чуть более компактно. Если одна из
меток списка слишком длинная для того, чтобы по ней выравниваться, то
этот пункт лучше отметить командой \textcmd{longitem}. Подробности
можно почерпнуть в файле документации \textfile{eqlist.pdf}.

\subsubsection{desclist}
\label{sec:base-2:desclist}
Схожую c пакетом \textpkg{eqlist} функциональность предоставляет стиль
\textpkgemph{desclist} из~пакета \textpkg{ncctools}
\begin{example}[0.5\textwidth]{base2-list-3}
\begin{desclist}{\bfseries}
           { \hfill---}[description]
  \item[enumerate] нумерованный,
  \item[itemize] ненумерованный,
  \item[description] без метки.
\end{desclist}
\end{example}
Первый параметр окружения \textenvemph{desclist} "--- это то, что ставится
перед меткой, второй параметр "--- это то, что ставится после метки, а
необязательный параметр представляет собой текст, по которому
происходит выравнивание. Подробности можно узнать в файле
\textfile{desclist.pdf}.

\subsubsection{paralist}
\label{sec:base-2:paralist}

Кроме многоабзацных перечней, о которых речь шла ранее, перечни могут
быть и внутриабзацными, для их автоматического формирования можно
воспользоваться пакетом \textpkgemph{paralist}:
\begin{example}[0.55\textwidth]{base2-list-4}
Перечни формируются с помощью окружений
\begin{inparaenum}
  \item enumerate,
  \item itemize и
  \item description.
\end{inparaenum}
\end{example}
Для симметрии к нумерованному окружению \textenvemph{inparaenum} есть
ненумерованное \textenv{inparaitem}. Документация доступна в исходнике
пакета \textfile{paralist.dtx}.


\section{Рубрикация}
\label{sec:base2:section}

%  {\setlength{\epigraphwidth}{0.6\textwidth} \epigraph{Нужны ли книге
%      оглавление или содержание? Любой скажет: что за вопрос, конечно,
%      нужны. И не только в книге научной и деловой. В
%      любой.}{\emph{А.Э.\,Мильчин <<Культура издания>>}}}

% \begin{wrapfigure}{r}{0.48\textwidth}
%   \centering 
%   \fbox{\includegraphics[width=0.38\textwidth]{base/apparatus-section.eps}}
%   \caption{Пример рубрикации}\label{fig:base2:section}
% \end{wrapfigure}

<<Нужны ли книге оглавление или содержание? Любой скажет: что за
вопрос, конечно, нужны. И не только в книге научной и деловой. В
любой>>. А.\,Э.\,Мильчин.

Для оформления разделов в основном используются команды
секционирования \textcmdemph{section}, \textcmdemph{subsection},
\textcmdemph{subsubsection}, \textcmdemph{paragraph} и
\textcmdemph{subparagraph}. Команды перечислены в порядке убывания
значимости при рубрикации.

Кроме самих заголовков разделов, созданных с помощью команд
секционирования, часто в начале создаётся и оглавление. За создание
оглавления отвечает команда \textcmdemph{tableofcontents}.  При каждой
компиляции информация о разделах собирается в файле с тем же именем,
что и у tex-файла, но с расширением \textext{toc}. При
следующей компиляции эта обновлённая информация о разделах используется
при создании оглавления.

% \begin{wrapfigure}{r}{0.48\textwidth}
%   \centering 
%   \fbox{\includegraphics[width=0.38\textwidth]{base/apparatus-section.eps}}
%   \caption{Пример рубрикации}\label{fig:base2:section}
% \end{wrapfigure}
\begin{figure}[t]
  \centering
  \includegraphics[width=0.45\textwidth]{base/apparatus-section-1.eps}\hfill
  \includegraphics[width=0.45\textwidth]{base/apparatus-section-2.eps}
  \caption{Пример рубрикации}\label{fig:base2:section}
\end{figure}
Обычно любой сколько-нибудь сложный текст следует начинать с
планирования структуры, то есть создать план"=шаблон будущего
документа. На рис.~\ref{fig:base2:section} с~точностью до размеров
листа бумаги представлен результат компиляции следующего
за этим абзацем кода.

\begin{lstlisting}[]
|\label{ex:base2:section}||\bs|documentclass[10pt]{scrartcl} 
\usepackage[warn]{mathtext}
\usepackage[T2A]{fontenc}
\usepackage[koi8-r]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{indentfirst}
\title{Пример рубрикации}
\author{А.\,В.~Тор}
|\bs|begin{document}
\maketitle{}
\tableofcontents{}

|\bs|section{Раздел}
\label{sec:section}
Основной элемент рубрикации. 

|\bs|subsection{Подраздел}
\label{sec:subsection}
Вспомогательный элемент рубрикации.

|\bs|subsubsection[Подподраздел]{Более мелкое, чем подраздел}
\label{sec:subsubsection}
Вспомогательный для вспомогательного. В содержании выводится 
краткая версия заголовка.

|\bs|paragraph{Параграф}
\label{sec:paragraph}
Важный параграф.

|\bs|subparagraph{Подпараграф}
|\bs|label{sec:subparagraph}
Параграф чуть менее важный.

|\bs|section*{Раздел, отсутствующий в содержании}

Всяко бывает. Иногда и такое нужно.

|\bs|section*{Заключение}
\label{sec:afterwords}
\addcontentsline{toc}{section}{Заключение} 

Заключение в отличие от, скажем, раздела~\ref{sec:subsection} 
на странице~\pageref{sec:subsection} нумеровать не надо, но 
в~содержании отразить необходимо.

|\bs|appendix

|\bs|section{Приложение}
\label{appendix}

|\bs|end{document}

\end{lstlisting}

Раздел типа \textcmdemph{section} соответствует первому уровню
секционирования, раздел \textcmdemph{subsection} "--- второму и так
далее. При желании можно ограничить уровень отображения информации в
оглавлении.  Для этого следует изменить значение переменной
\textcount{tocdepth}, например, так:\textcmdh{setcounter}
\begin{lstlisting}[]
\setcounter{tocdepth}{2}

\end{lstlisting}

В этом случае будет показана информация о разделах вплоть до второго
уровня включительно. 


Кроме оглавления также можно вывести список иллюстраций
\textcmd{listoffigures} и таблиц \textcmd{listoftables}. Информация об
иллюстрациях и таблицах автоматически собирается в файлах с
расширениями \textext{lof} и \textext{lot}.

Для добавления какой-то информации в оглавление в обход команд
секционирования можно воспользоваться командой \textcmdhemph{addcontentsline}
\begin{lstlisting}[]
\addcontentsline{toc}{|<<уровень раздела>>|}{|<<строка в оглавлении>>|}

\end{lstlisting}

У этой команды три аргумента. Первый аргумент соответствует расширению
файла (\textext{toc}, \textext{lof} или \textext{lot}), куда
добавляется <<строка в оглавлении>>.  Уровень раздела определяется
именами команд секционирования, то есть section, subsection и так
далее. Команды \LaTeX{} при передаче в файлы списков следует защищать
командой \textcmd{protect}, дабы избежать проблем с <<хрупкими>>
инструкциями.

Команда \textcmdemph{appendix} отделяет приложение от основного
текста. После её вызова правила нумерации разделов
изменяются. \textcmdemph{appendix} тоже является командой
секционирования. 

При оформлении книг (производные от \textpkg{book} классы, например,
\textpkg{scrbook}) к командам рубрикации добавляется ещё два уровня
\textcmdemph{chapter} "--- глава и \textcmdemph{part} "--- часть. Помимо этого
традиционно крупные художественные формы разбиваются на три части:
\emph{вступительную} "--- открывается командой \textcmdemph{frontmatter}
(нумеруется римскими цифрами), \emph{основную} "--- открывается
командой \textcmdemph{mainmatter} (нумеруется арабскими цифрами) и
\emph{заключительную} "--- открывается командой \textcmdemph{backmatter}.
При этом главы нумеруются только в основной части. Во вступительной
части обычно помещают титульный лист (окружение \textenvemph{titlepage})
и оглавление:
\begin{lstlisting}[]
|\bs|documentclass[a4paper,12pt]{scrbook} 

  |\ldots|

% Создать указатель
\makeindex

|\bs|begin{document}

% Вступительная часть
|\bs|frontmatter

|\bs|begin{titlepage}
   Титульный лист  
|\bs|end{titlepage}

\tableofcontents{}

% Основная часть 
|\bs|mainmatter

|\bs|chapter{Глава 1}
\label{cha:chapter-1}

|\bs|chapter{Глава 2}
\label{cha:chapter-2}

% Заключительная часть
|\bs|backmatter
% Библиография
\bibliographystyle{gost780u}
\bibliography{bibfile}

% Вывести указатель
\printindex

|\bs|end{document}

\end{lstlisting}



\section{Ссылки, сноски и примечания}
\label{sec:base2:labelsandfooters}

Иногда не хочется разбивать канву повествования и в то же время
необходимо как-то вставить пояснение. Это можно сделать, просто
сославшись на какой-то другой фрагмент текста с помощью ссылки, или
вставить пояснение на этой же странице с помощью подстрочного
примечания, или отнести пояснение в конец книги.

\subsection{Механизм ссылок}
\label{sec:base2:labels}

В примере на стр.~\pageref{ex:base2:section}, демонстрирующем работу
команд секционирования, вслед за каждой командой секционирования
ставилась метка с помощью инструкции \textcmdemph{label}. Метка
представляет из себя последовательность ASCII"=символов. При компиляции
документа информация об имеющихся метках добавляется в файл с
расширением aux. Для того чтобы извлечь эту информацию, то есть номер
раздела (команда \textcmdemph{ref}) или номер страницы (\textcmdemph{pageref}),
необходимо пропустить текст через \textprog{latex} ещё раз.

\mindex{ссылка внешняя}
Для того чтобы можно было сослаться на внешний документ, следует
воспользоваться пакетом \textpkgemph{xr}. В данном случае в преамбуле
необходимо  добавить примерно следующие инструкции:
\begin{lstlisting}[]
\usepackage{xr}
\externaldocument[EXT-]{externaldoc}

\end{lstlisting}

Это позволяет получить доступ к меткам файла
\textfile{externaldoc.tex}. Обращение к меткам, как и обычно,
осуществляется с помощью команд \textcmdemph{ref}/\textcmdemph{pageref},
только перед именем метки добавляется префикс \textopt{EXT-}.  Можно
обойтись и без префикса, так как данный параметр является опциональным,
но в этом случае повышается вероятность конфликта из-за одинаковых
меток.

Ссылаться можно не только на разделы. Метки внутри нумерованных
окружений, типа \textenv{equation} (выключенные математические
формулы) или \textenv{theorem} (теоремы), принимают их
номер. Это также касается рисунков (окружение \textenv{figure}) и
таблиц (окружение \textenv{tabular}). В таком случае \textcmdemph{label}
должна следовать сразу за~командой \textcmd{caption}, формирующей
подпись к плавающему объекту.

\mindex{ссылка на формулу} Обычно ссылку на формулу заключают в
скобки. Для того чтобы не путаться, в пакете \textpkg{amsmath}
определена ещё одна команда ссылки \textcmdemph{eqref}. Для правильной
ссылки на номера формул вместо команды \textcmdemph{ref} следует
\emph{всегда} использовать инструкцию \textcmdemph{eqref}:
\begin{examplenv}[0.54\textwidth]{math-ref-1}
\begin{equation}
  \label{eq:1}
  x_{1,2}=\frac{-b\pm\sqrt{b^2-4ac}}{2a}
\end{equation}
Обычная ссылка~\ref{eq:1}\par
Ссылка на формулу~\eqref{eq:1}
\end{examplenv}
Из примера видно, что метка состоит из двух частей в виде префикса
\textopt{ex} и остатка. Обычно для каждого окружения выбирают свой
префикс. Этот обычай как нельзя кстати, если воспользоваться
возможностями пакета \textpkgemph{prettyref}. Данный пакет в зависимости
от префикса метки позволяет сформировать внешний вид ссылки. 
\medskip

\begin{examplenv}[0.52\textwidth]{math-ref-2}
%связываем префикс с новым видом
\newrefformat{eq}{формула \No~\ref{#1}}
Новый вид ссылки: \prettyref{eq:1}
\end{examplenv}
\medskip

При использовании \textcmdemph{prettyref} для формирования ссылки в имени
метки не должно быть более одного двоеточия (\textopt{:}), разделяющего
префикс и остаток.
%\smallskip

\mindex{ссылки!визуализация}
\Note При подготовке документов с большим количеством ссылок можно в
них запутаться. Для визуализации меток можно воспользоваться пакетом
\textpkg{showkeys}. При инициализации пакета все метки и ссылки
подписываются, что облегчает процесс поиска неправильных ссылок.


\subsection{Подстрочные примечания}
\label{sec:base2:footnotes}
\mindex{сноска|(}

Подстрочное примечание формируется с помощью команды
\textcmdemph{footnote}. Правила оформления примечаний прописываются в
определении класса. Без особых на то причин менять эти правила не
стоит. Примечание, если позволяет место, печатается на той же странице,
где помещена ссылка. Текст и примечание отделяются разделительной
линией. 

Примечание можно добавлять и внутри окружения \textenv{minipage}, но
тогда оно печатается внутри окружения:
\medskip

\begin{examplenv}[0.59\textwidth]{base2-footnote-1}
\begin{minipage}{1.0\linewidth}
    Ссылки раз\footnote{Сноска.} и
  два\footnote[26]{Подстрочное примечание.}.
\end{minipage}
\end{examplenv}
\medskip

Необязательный параметр \textcmdemph{footnote} позволяет присвоить
примечанию значение по выбору пользователя.

Для того чтобы можно было сделать сноску внутри заголовка раздела,
необходимо защитить инструкцию \textcmdemph{footnote} командой
\textcmd{protect}, так как команда создания подстрочного примечания
является <<хрупкой>>:  \mindex{хрупкие команды}
\begin{lstlisting}[]
|\bs|section{Заголовок\protect\footnote{Подстрочное примечание.}} 
\end{lstlisting}


В сложных ситуациях, например, когда требуется сделать
подстрочное примечание внутри бокса, для формирования сноски нужно
прибегнуть к независимым командам создания ссылки и создания
примечания соответственно:\textcmdhemph{footnotemark}\textcmdhemph{footnotetext}
\begin{lstlisting}[]
\footnotemark[num]
\footnotetext[num]{|<<сноска>>|}

\end{lstlisting}

Необязательный параметр num, как и в случае команды \textcmdemph{footnote},
позволяет формировать свою нумерацию.  Для хранения текущего номера
ссылки используется счётчик \textcount{footnote}.


\subsubsection{nccfoots}
\label{sec:base2:nccfoots}

Стиль \textpkgemph{nccfoots} из пакета \textpkg{ncctools} позволяет
организовать ручную нумерацию подстрочных примечаний:
\begin{example}[0.63\textwidth]{base2-footnote-2}
\begin{minipage}{1.0\linewidth}
Ссылки раз\Footnote{$\alpha$}{Сноска.} и
два\Footnotemark{$\beta$}.
\Footnotetext{$\beta$}{Подстрочное примечание.}
\end{minipage}
\end{example}
У аналогов стандартных команд есть дополнительный обязательный
параметр, куда следует поместить метку.

\subsubsection{footmisc}
\label{sec:base2:footmisc}

Стилевой файл \textpkgemph{footmisc} (документация
\textfile{footmisc.pdf}) позволяет управлять параметрами
сносок. При загрузке можно передать следующие опции:
\begin{eqlist*}
\item[\textopt{perpage}] "--- нумерация сносок при переходе на новую
  страницу опять начинается с единицы;
\item[\textopt{para}] "--- подстрочные примечания печатаются подряд
  как единый  параграф без переноса строки. Иногда такое оформление
  востребовано в критических заметках, где требуется много сносок;
\item[\textopt{side}] "--- печать подстрочного примечания на полях;
\item[\textopt{symbol*}] "--- знак сноски становится символьным;
\item[\textopt{norule*}] "--- перед примечанием не печатается
  разделяющая линейка.
\end{eqlist*}
% Для выяснения подробностей следует обратиться к файлу
% \textfile{footmisc.pdf}.


\subsubsection{savefnmark}
\label{sec:base2:savefnmark}

С помощью пакета \textpkgemph{savefnmark} можно переиспользовать старые метки. В
нём определяются две команды: 
\begin{eqlist*}
\item[\textcmdemph{saveFN}] "--- сохраняет последнюю метку в именованную
  структуру, следующую за командой;
\item[\textcmdemph{useFN}] "--- восстанавливает сохранённую метку.
\end{eqlist*}
\begin{example}[0.63\textwidth]{savefnmark}
Сноска\footnote{примечание}\saveFN\oldfoot\par
Переиспользуем сноску\useFN\oldfoot
\end{example}

При желании можно сохранять номер сноски внутри таблицы для переиспользования
его в тексте и наоборот.

\mindex{сноска|)}

\subsection{Затекстовые примечания}
\label{sec:base2:endnotes}

Изредка, когда текст в сносках может усложнять прочтение документа,
можно вместо подстрочных примечаний организовать затекстовые. По
возможности этой структуры следует избегать.

\subsubsection{endnotes}
\label{sec:base-2:endnotes}

Для создания затекстовых примечаний можно воспользоваться стилевым
файлом \textpkgemph{endnotes} из пакета \textpkg{ltxmisc}. В пакете
определён набор макросов совершенно аналогичных командам для
формирования подстрочных примечаний: \textcmdemph{endnote},
\textcmdemph{endnotemark} и \textcmdemph{endnotetext}. Дополнительно
определена команда для простого добавления текста без всякой метки
\textcmdemph{addtoendnotes}\lstinline!{текст}!.  Для печати
затекстовых комментариев в конце текста следует добавить команды:
\textcmdhemph{theendnotes} \textcmdh{notesname}
\begin{lstlisting}[frame=]
\renewcommand{\notesname}{Затекстовые комментарии}
\theendnotes
\end{lstlisting}

Информация об использовании стиля \textpkgemph{endnotes} находится в самом
стилевом файле \textfile{endnotes.sty}.

\subsubsection{pagenote}
\label{sec:base-2:pagenote}

Аналогичную \textpkg{endnotes} функциональность  предоставляет и пакет
\textpkgemph{pagenote}.
\textcmdhemph{makepagenote}
\textcmdhemph{pagenote}
\textcmdh{notesname}
\begin{lstlisting}[]
% Преамбула
\usepackage[page]{pagenote}
\makepagenote
      |\ldots|
% Тело документа
Текст\pagenote{Примечание}
      |\ldots|
\renewcommand{\notesname}{Затекстовые комментарии}
\printnotes
\end{lstlisting}

Опция \textopt{page} добавляет при формировании списка затекстовых
примечаний номера страниц, на которых на них ссылались. Также пакету
можно передать опцию \textopt{continuous}. В этом случае при окончании
главы нумерация затекстовых примечаний не обнуляется.

Команда \textcmdemph{printnotes} печатает все определённые до неё
затекстовые примечания и запрещает добавление новых. В отличие от неё
команда \textcmdemph{printnotes$*$} позволяет использовать
себя несколько раз, например, в конце каждой
главы. \textcmdemph{printnotes$*$} печатает уже определённый
до неё список примечаний и очищает его для последующих добавлений.

\subsection{Заметки на полях}
\label{sec:base2:marginnotes}

Большие поля некоторых классов, например, стандартных типа
\textpkg{article}, позволяют оставлять на них заметки прямо по ходу
текста. Заметки на полях можно оставлять с помощью команды
\textcmdemph{marginpar}\lstinline!{текст}!. \marginpar{тест} У~команды
есть необязательный аргумент, который если определён, то печатается,
если заметка попадает на~левое поле. Для того чтобы поменять поле по
умолчанию, на~котором печатается заметка, на другое, следует
воспользоваться командой \textcmd{reversemarginpar}, а восстановить
старый порядок можно с помощью \textcmd{normalmarginpar}.

\subsubsection{marginnote}
\label{sec:base-2:marginnote}

Команда \textcmd{marginpar} при формировании заметки создаёт плавающий
объект, и поэтому в некоторых случаях её нельзя использовать, например,
в подстрочных примечаниях или в других плавающих объектах. Пакет
\textpkgemph{marginnote} определяет одноимённый макрос для создания
заметок, который лишён этого недостатка:
\textcmdhemph{marginnote}
\begin{lstlisting}[frame=]
\marginnote[|<<заметка слева>>|]{|<<заметка справа>>|}[|<<сдвиг>>|] 
\end{lstlisting}

Первые два аргумента полностью соответствуют \textcmd{marginpar}, а
последний необязательный аргумент может применяться для вертикального
выравнивания заметки на полях. Положительное значение <<сдвига>>
перемещает заметку вниз, а отрицательное "--- вверх. Подробности можно
найти в файле \textfile{marginnote.pdf}.


\Note Иногда при формировании заметок на полях в начале страницы
заметка оказывается не с той стороны, с которой должна быть по
умолчанию. Для исправления этого бага \LaTeX{} был написан стиль
\textpkg{mparhack} "--- его достаточно просто загрузить. 

\subsubsection{changebar}
\label{sec:base-2:changebar}
%\cbstart %какие-то проблемы с pdflatex
На полях можно оставлять не только текстовые метки. Пакет
\textpkgemph{changebar} написан для индикации изменений в тексте.
Изменённый текст следует окружить макросами \textcmdemph{cbstart} и
\textcmdemph{cbend}, и он будет помечен как этот параграф.  Пакет
может работать как \textprog{dvips}, так и \textprog{pdflatex}.
Толщину линии и цвет можно легко настроить. Более подробно об этом
пакете можно узнать в файле \textfile{changebar.pdf}.

%\cbend %какие-то проблемы с pdflatex


\subsection{WWW-элементы}
\label{sec:base2:WWW}

Общего рецепта, как делать ссылки на электронные ресурсы, нет. Проще
всего использовать команду \textcmd{url} из одноимённого пакета.

\subsubsection{url}
\label{sec:base2:url}

\mindex{ссылка WWW}
\mindex{гиперссылка}

Пакет \textpkgemph{url} позволяет печатать www-адреса, не особо заботясь об
экранировании спецсимволов.
\begin{example}[0.44\textwidth]{base2-url}
Моя WWW-страничка находится тут: 
\url{http://www.inp.nsk.su/
          ~baldin/}.
\end{example}
В тексте ссылки не допускаются символы \%, \#, \^{}, и она не должна
заканчиваться символом \bs. Если есть желание уйти и от этих
ограничений, то аналогично команде \textcmd{verb} инструкцию можно
использовать и так: \textcmdemph{url}\lstinline|!http://www.адрес.ru!|.


\subsubsection{hyperref}
\label{sec:base2:hyperref}


\mindex{ссылка WWW}
\mindex{гиперссылка}

В плане создания гиперссылок особенно интересен пакет
\textpkgemph{hyperref}. Этот пакет не просто позволяет печатать ссылки на
электронные ресурсы "--- он их реально делает. Достаточно загрузить
пакет:
\begin{lstlisting}[]
% Загрузка пакет hyperref
\usepackage[unicode=true]{hyperref}
\end{lstlisting}
и в документе появятся гиперссылки. Гиперссылками станут и обычные
ссылки, и оглавления. Также они появятся в алфавитных указателях и
в библиографии. Пакет ориентирован на использование для
pdf-документов, но гиперссылки можно увидеть и с помощью
некоторых программ просмотра dvi-файлов, например, с помощью
\textprog{xdvi}. Опция \textopt{unicode=true} нужна, чтобы 
сформировать русские закладки.

Подробная инструкция об использовании \textpkgemph{hyperref} находится
в директории документации пакета в файле \textfile{manual.pdf}. В сети
есть замечательная авторская документация по этому пакету на русском языке,
созданная Владимиром Сюткиным:
\url{http://www-sbras.nsc.ru/win/docs/TeX/LaTex2e/docs_koi.html}.
\smallskip

\Note Пакет \textpkgemph{hyperref} конфликтует со множеством других
пакетов \LaTeX.

\subsubsection{breakurl}
\label{sec:base2:breakurl}

\mindex{ссылка WWW}
\mindex{гмперссылка}

При использовании \textprog{pdflatex} совместно с \textpkg{hyperref}
www-адреса автоматически переносятся на следующую строку, но если
используется классическая схема в~виде
\textprog{latex}\(\to\)\textprog{dvips}\(\to\)\textprog{ps2pdf}, то
автоматического переноса не происходит. Эту проблему и призван решить
пакет \textpkgemph{breakurl}.

Пакет \textpkgemph{breakurl} следует загружать после \textpkg{hyperref}. В
пакете определена команда \textcmdemph{burl}, которая является идентичной
по использованию \textcmd{url}.
\bigskip

\noindent\includegraphics[]{base/base-2-burl.eps}
% \begin{example}[0.53\textwidth]{base2-burl}
% Моя WWW-страничка: 
% \burl{http://www.inp.nsk.su/~baldin/}.
% \end{example}

По умолчанию, если пакет не загружается с опцией
\textopt{preserveurlmacro}, то \textcmd{url} переопределяется как синоним
\textcmdemph{burl}. Документация к пакету "--- 
\textfile{breakurl.pdf}.



\section{Процесс подготовки документа}
\label{sec:base2:vc}



Подготовка текста "--- непростое занятие. Непростое и потому, что с первого
раза почти никогда ничего не получается. 


\subsection[Авторские метки с FiXme]{Авторские метки с \fixmelogo}
\label{sec:make-up:fixme}

\mindex{черновик}
\textpkghemph{fixme}
Далеко не всегда документ создаётся <<набело>>. Постоянно в процессе
подготовки текста возникают вопросы, которые не удаётся решить
сразу. Это нормально. Проблема заключается лишь в том, что требуется
как-то отметить проблемный кусок, чтобы затем его доделать.

Пакет \fixmelogo{} предоставляет четыре команды:
\begin{eqlist}
\item[\textcmdemph{fxnote}] "--- заметка;
\item[\textcmdemph{fxwarning}] "--- предупреждение;
\item[\textcmdemph{fxerror}] "--- не фатальная ошибка;
\item[\textcmdemph{fixme}] "--- требование для обязательного
  исправления.
\end{eqlist}
В качестве аргумента каждой из этих команд передаётся строка текста.

При активизации опции \textopt{draft} при загрузке стиля документа,
например, так:
\begin{lstlisting}[]
\documentclass[a4paper,12pt,draft]{scrbook}   
\end{lstlisting}
текст, передаваемый этим командам в качестве аргумента, по умолчанию
выводится на полях документа. При отсутствия опции \textopt{draft} или
наличии опции \textopt{final} заметки исчезают. Команда
\textcmd{listoffixmes} формирует список заметок по подобию оглавления.

Кроме этого команда \textcmdemph{fixme} инспирирует ошибку при компиляции
документа, что не позволит при окончательной вёрстке пропустить важные
нерешённые проблемы.

Для подключения пакета необходимо загрузить стиль \textpkgemph{fixme}. В
качестве параметра при загрузке можно передать информацию о размещении
предупреждений: \textopt{inline} "--- разместить прямо в тексте, \textopt{margin}
"--- разместить на полях (по~умолчанию), \textopt{footnote} "---
выводить предупреждения как подстрочные
примечания и  \textopt{index} "--- разместить в алфавитном
указателе. Информация по пакету в \textfile{fixme.pdf}.


\switchlinenumbers
\setpagewiselinenumbers
\linenumbers
\subsection{Нумерация строк с lineno}
\label{sec:base2:lineno}
\mindex{нумерация строк}

Пакет \textpkgemph{lineno} предназначен исключительно для нумерации строк
в документе. Это упрощает навигацию внутри текста для указания
конкретной ошибки. 

Самый простой способ пронумеровать небольшой фрагмент "--- это
воспользоваться окружением \textenvemph{linenumbers}. Для больших
фрагментов лучше использовать пару деклараций
\textcmdemph{linenumbers}/\textcmdemph{nolinenumbers}, которые,
соответственно, включают и выключают нумерацию. 

По умолчанию нумерация идёт сквозная и размещается слева от
текста. Для~переключения режима, когда с каждой новой страницей
нумерация начинается с~единицы, следует воспользоваться макросом
\textcmd{setpagewiselinenumbers}. Для того чтобы нумерация всегда
располагалась с внешней части документа, используется макрос
\textcmd{switchlinenumbers}, а при добавлении $*$ (звёздочки)
нумерация всегда будет на внутренних полях документа.

Метку для ссылки на строку можно установить так:
\textcmdemph{linelabel}\lstinline!{ex:lineno}!. \linelabel{ex:lineno}
А~теперь с помощью обычной команды \textcmd{ref} можно сослать на эту
строку \No\,\ref{ex:lineno}. Эта возможность не корректно работает с
пакетом \textpkg{hyperref} (создаётся неопределённая гиперссылка).
Дополнительную информацию для пользователя следует искать в~самом
конце  файла \textfile{lineno.pdf}.

\nolinenumbers

\subsection{Водяные знаки}
\label{sec:base2:watermark}

\mindex{фоновый текст}
\mindex{черновик}

\begin{floatingfigure}[o]{0.46\textwidth}
  \centering
  \includegraphics[width=0.355\textwidth]{base/watermark.eps}
  \caption{\textpkgemph{draftwatermark}}\label{fig:base2:watermark}
\end{floatingfigure}
Чтобы показать, что копия документа не окончательная, или просто
вставить какой"=то текст в качестве фона, можно воспользоваться
специализированным пакетом  \textpkgemph{draftwatermark}. С
помощью него можно делать <<водяные знаки>>. Этот
пакет полностью перекрывает возможности  ранее популярного, но
устаревшего пакета \textpkg{draftcopy}.  После загрузки пакета 
 через всю страницу по~диагонали печатается слово <<DRAFT>>. Пакет
совместим как с \textprog{dvips}, так и с \textprog{pdflatex}.

Стилю можно передать для печати своё сообщение и изменить
размер шрифта. На рис.~\ref{fig:base2:watermark} изображена страница, на
фоне которой идёт надпись <<Рабочая версия>>. Для того чтобы её
получить, в преамбуле были добавлены следующие строки:
\textcmdhemph{SetWatermarkScale}
\textcmdhemph{SetWatermarkLightness}
\textcmdhemph{SetWatermarkText}
\begin{lstlisting}[]
% Загрузка пакета
\usepackage{draftwatermark}
% Масштабирование базового шрифта
\SetWatermarkScale{2.3}
% Изменение насыщенности
\SetWatermarkLightness{0.3}
% Пользовательская строка
\SetWatermarkText{\textbf{Рабочая версия}}
\end{lstlisting}

Если при загрузке \textpkgemph{draftwatermark} ему передаётся опция
\textopt{firstpage}, то сообщение печатается только но первой
странице. Максимальная насыщенность текста соответствует  0, а
минимальная "--- 1. Размер шрифта можно задать и напрямую с помощью макроса
\textcmd{SetWatermarkFontSize}. Для задания угла наклона фонового
сообщения есть команда
\textcmdemph{SetWatermarkAngle}\lstinline!{угол}!.


\Note Стиль \textpkg{watermark} из пакета \textpkg{ncctools} позволяет
выводить на подложке страницы не только текст, но и графические
объекты.  Схожую функциональность предоставляют пакеты
\textpkg{bophook}, \textpkg{eso-pic} и \textpkg{wallpaper}.
\bigskip

\subsection{Сложные документы}
\label{sec:base:complexdocs}

\mindex{составные документы|(}
Всё можно хранить в одном файле "--- это ничему не противоречит. Более
того, само понятие файл для пользователя не так уж и необходимо. Но уж
если файл есть, то почему бы не разделить большой текст на несколько
частично независимых фрагментов? 

С помощью команды \textcmdemph{input}\lstinline!{имя файла}! можно
вставлять другой tex-файл в~документ. \LaTeX{} просто
добавляет содержимое по месту команды, считывая файл либо до конца,
либо до первой встретившейся инструкции \textcmdemph{endinput}. Совершенно
не важно, в какой части документа встречается \textcmdemph{input}. Бывает
довольно удобно вынести преамбулу в отдельный файл. В имени файла
можно опустить расширение~\textext{tex}.

Для включения больших фрагментов текста, таких как главы, можно
воспользоваться декларацией \textcmdemph{include}.  В преамбуле с помощью команды
\textcmdemph{includeonly} можно перечислить, какие части надо
подключить при текущей сборке. При этом сохраняется правильная
нумерация страниц, и можно сослаться на \emph{не} включённые в эту
сборку разделы. Сохранение правильной нумерации становится возможным,
так как при использовании команды \textcmd{include} перед вставкой
кода добавляется декларация \textcmd{clearpage}, которая гарантирует, что
<<плавающие объекты>> не выйдут за пределы своей главы.

Пример использования \textcmdemph{include}: 
\begin{lstlisting}[]
% Загрузка стандартной преамбулы
\input{preheader} 
% Введение и презентация в эту сборку не включается
\includeonly{
%  intro, 
 base,
% presentation
}
\begin{document}
\include{intro} % Введение
\include{base}  % Базовые элементы
\include{presentation} % Презентация
\end{document}

\end{lstlisting}

Команда \textcmdemph{include} позволяет включить только tex"=файл (при
написании имени расширение \textext{tex} опускается).
Данный метод особенно актуален в случае больших текстов в процессе их
создания, так как значительно ускоряет компиляцию. В~приведённом ранее
примере  подключается только глава \textfile{base.tex}.


%\smallskip

%note
\Note При помещении команды \textcmd{listfiles} в преамбуле можно узнать,
какие реально файлы используются при компиляции текста. Список
посылается на стандартный вывод при компиляции.



\subsubsection{excludeonly}
\label{sec:base-2:excludeonly}

В дополнение к декларации \textcmd{includeonly} пакет
\textpkgemph{excludeonly} добавляет одноимённую команду, которая
позволяет исключать переданные в качестве аргумента  главы. Это
может быть удобнее и нагляднее, чем ставить комментарии.

Для того чтобы, как и ранее по тексту, подключить только
\textfile{base.tex}, к инструкции \textcmd{includeonly} следует
добавить \textcmdemph{excludeonly}:

\begin{lstlisting}[]
\includeonly{intro,base,presentation}
\excludeonly{intro,presentation}

\end{lstlisting}

\subsubsection{askinclude}
\label{sec:base-2:askinclude}

Для интерактивного добавления глав в основной документ можно
воспользоваться пакетом \textpkgemph{askinclude}. В этом случае при
подключении пакета в процессе компиляции у пользователя запрашивается
разрешение на выполнение команд \textcmd{include}. Это полезно, если
хочется подготовить разные части книги, не модифицируя исходники.


\subsubsection{optional}
\label{sec:base-2:optional}

Пакет \textpkgemph{optional} из коллекции \textpkg{ltxmisc}
предоставляет пользователю команду \textcmdemph{opt}, используя
которую можно выводить нужный вариант текста или кода:
\begin{lstlisting}[]
% Файл variant.tex
\usepackage[answer1]{optional}

Стандартная шапка "--- выводится всегда.

\opt{variant1,answer1}{\input{variant1}}
\opt{variant2,answer2}{\input{variant2}}

\opt{}{Этот текст никогда не будет напечатан}

\opt{answer1}{\input{answer1}}
\opt{answer2}{\input{answer2}}

\end{lstlisting}

Для интерактивного выбора можно воспользоваться командой
\textcmdemph{AskOption}, поместив её в преамбуле. Полезно также в этом
случае поместить в преамбулу и описание меток:
\begin{lstlisting}[]
\newcommand{\ExplainOptions}{variant1, variant2 - problems;
 answer1, answer2 - solutions}
\AskOption

\end{lstlisting}

При компиляции текста будет задан вопрос, какую метку выбрать:
\begin{lstlisting}[language=bash]
 |\ldots|

variant1, variant2 - problems; answer1, answer2 - solutions
Specify which optional text to process:

\UseOption=

\end{lstlisting}

Указать правильную опцию можно и из командной строки:\textcmdhemph{AskOption}
\begin{lstlisting}[language=bash]
> latex "\newcommand\UseOption{answer1}\input{variant}"

\end{lstlisting}

Это легко можно встроить в какой-либо сценарий или написать
соответствующий \textfile{Makefile}. Подробности можно найти в
комментариях к самому коду пакета \textfile{optional.sty}.

\textpkghemph{optional}



\mindex{составные документы|)}






%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "../ctex"
%%% End: 
