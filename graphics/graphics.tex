%  -*- coding: koi8-r -*-
\chapter{Вставка графики}
\label{cha:graphics}

{%\setlength{\epigraphwidth}{0.36\textwidth} 
  \epigraph{\flushright Картинка стоит тысячи слов.}{\emph{Английская пословица}} }


Вероятно, \TeX{} на текущий момент лучше других программ вёрстки умеет
разбивать абзацы на строки. То есть удачнее всех разливать порции
<<клея>> между <<боксами>>, но подготовка графики выносится за рамки
этого процесса. Почти\ldots


С точки зрения \TeX{} картинка "--- это просто очень большой
прямоугольник, который надо как-то разместить на странице. От
пользователя нужны только размеры этого прямоугольника. Отображение же
иллюстрации лежит на плечах драйверов. Самым востребованным форматом
для представления графики в \LaTeX{} до сих пор является Encapsulated
PostScript.

\section{Encapsulated PostScript}
\label{sec:graphics:eps}
\mindex{графический формат!eps|(}

Уже больше двадцати лет прошло с тех пор, как никому не известная фирма
Adobe Systems получила инвестиции от фирмы Apple на <<обучение>>
лазерных принтеров молодому тогда ещё языку PostScript. Как следствие, этот
платформонезависимый язык с полностью открытой спецификацией стал
безальтернативным стандартом. Даже сейчас PostScript фактически не
имеет конкурентов в области допечатной подготовки. Поэтому почти все
<<уважающие себя>> графические программы умеют экспортировать результаты
своей деятельности в виде инструкций PostScript. Особенно это касается
векторных графических редакторов, так как PostScript подразумевает
векторную графику.


Encapsulated PostScript или кратко EPS "--- это векторный графический
формат. Файлы в этом формате, как правило, имеют расширение \textext{eps}.
Это фактически тот же PostScript, но с некоторыми упрощениями и
дополнительными договорённостями. Самая интересная с точки зрения
\LaTeX{} договорённость "--- это обязательное наличие в заголовке
информации о размере картинки, которая передаётся вместе с
комментарием:
\begin{lstlisting}[language=Clean]
%!PS-Adobe-2.0 EPSF-2.0
%%Creator: dvips(k) 5.95b Copyright 2005 Radical Eye Software
%%Title: picture.dvi
%%BoundingBox: 127 464 430 667
%%DocumentFonts: SFRM1200 SFRM0800
%%EndComments

\end{lstlisting}
Первая строка комментария обычно содержит версию
PostScript\footnote{Некоторые программы перед комментарием добавляют
  бинарный мусор. Не будем тыкать пальцем в драйвер вывода для
  PostScript-принтеров у одной очень распространённой
  операционной системы. Для полноценной работы с такими файлами этот
  мусор необходимо удалить.}. Вслед за комментарием
\textopt{BoundingBox} идёт информация о размерах. Первые два числа
соответствуют координатам левого нижнего угла картинки, а последние
соответствуют координатам правого верхнего угла. Единицей измерения
является <<большой пункт>> (bp=1/72\,in), который примерно равен
0.351\,мм. Для вёрстки текста указанной информации достаточно.

Чтобы из уже имеющегося одностраничного PostScript-файла сделать EPS,
необходимо и, как правило, достаточно добавить
\textopt{BoundingBox}. Для вычисления искомых размеров можно
воспользоваться утилитой \textprog{ps2eps} из одноимённого пакета. Если
же в стандартной поставке эта программа отсутствует, то можно напрямую
воспользоваться программой Ghostscript "--- свободным программным
интерпретатором PostScript:
\begin{lstlisting}[language=bash,frame=]
> gs -q -dSAFER -dNOPAUSE -dBATCH -sDEVICE=bbox |<<имя файла>>|

\end{lstlisting}
Размеры выясняются с помощью указания специального драйвера
\textopt{bbox}. Ключи \textopt{-q}, \textopt{-dNOPAUSE} и
\textopt{-dBATCH} используются для подавления ненужной информации и
вопросов со стороны программы. Ключ \textopt{-dSAFER} гарантирует, что
Ghostscript не будет производить никаких деструктивных
действий\footnote{Отключается возможность выполнения таких команд, как
  удаление и переименование, а чтение файлов происходит в режиме
  read-only. Очень полезный ключ, если Ghostscript используется в
  качестве фильтра.}.

Ещё одной особенностью EPS-формата является возможность добавлять
растровое изображения для предварительного просмотра. Это было сделано
для случаев, когда программы не понимают PostScript, но что-то на месте
дырки для картинки отобразить надо. Такое добавление идёт вразрез с
принципиальной кросс"=платформенностью PostScript, и по возможности
добавления картинки для предварительного просмотра следует
избегать. Но в любом случае для операции с этим расширением, в том
числе и для добавления/удаления можно воспользоваться утилитой
\textprog{epstool} из одноимённого программного пакета.


В конце рассказа про EPS хотелось бы упомянуть о замечательной утилите
\textprog{pstoedit} из, естественно, одноимённого же программного
пакета. Не все, но многие из более"=менее внятно созданных
PostScript-файлов она ухитряется перевести в редактируемый векторный
графический формат. Это упрощает работу с~правкой файлов, которые не
имеют исходников.

\mindex{графический формат!eps|)}

\section{Как из растра сделать EPS}
\label{sec::graphics:bmptoeps}

\mindex{графический формат!eps}
\mindex{графический формат!png}
\mindex{графический формат!jpeg}


Одним из важных вопросов вставки графики в \LaTeX{} является
конвертация растровых форматов в EPS. Растр гораздо проще
создавать. Кое-где, например, в случае снимков экрана, применение
растра оптимальнее векторных форматов. Стандартные подходы, как в
случае утилиты \textprog{convert} из пакета \textprog{ImageMagick}, не всегда
дают оптимальные результаты.

Возможным и вполне разумным решением является замена традиционной
линейки: \textprog{latex}\(\to\)\textprog{dvips}\(\to\)\textprog{ps2pdf}
на \textprog{pdflatex}, который сразу <<из коробки>> поддерживает растровые
форматы PNG\footnote{Portable Network Graphics "--- растровый
  графический формат, использующий сжатие без потерь.} и
JPEG\footnote{Joint Picture Experts Group "--- самый популярный
  графический формат из форматов, использующих сжатие с потерями.}, которые можно
внедрять в формат PDF\footnote{Portable Document Format "---
  платформонезависимый формат электронных документов, созданный Adobe
  System.} напрямую. Массового перехода на эту технологию пока не
видно, но заметное движение в эту сторону есть. У неё есть неоспоримые
достоинства, но она не лишена недостатков. Рассказ о \textprog{pdflatex}
выходит за рамки этого раздела.

Конвертацию из формата JPEG проще всего осуществить с помощью программы
\textprog{jpeg2ps}, которую можно найти  в любом CTAN"=архиве в директории
\CTANpath{/nonfree/support/jpeg2ps}. Утилита не
преобразовывает JPEG-файл, а просто добавляет правильный
eps"=заголовок. Декомпрессия картинки JPEG производится уже
PostSript"=интерпретатором. Это стало возможным, начиная с~версии
PostScript Level 2. К недостаткам утилиты можно отнести то, что в силу
своей лицензии она не может распространяться со свободными
дистрибутивами, а к достоинствам "--- отсутствие зависимостей от
других программных пакетов.

Более комплексными решениями являются утилиты \textprog{sam2p} из
одноимённого пакета и \textprog{bmeps}. Их также можно найти на CTAN в
директориях \textpath{graphics/sam2p} и \textpath{support/bmeps}
соответственно. \textprog{sam2p} является своеобразным комбайном, который
поддерживает множество растровых графических форматов, в то время как
\textprog{bmeps} фокусируется на PNG и JPEG. Обе эти программы позволяют
получить вполне приличную eps-картинку для печати или для просмотра на
экране. В обоих случаях необходимо поразбираться в ключах и
настройках. Программа \textprog{bmeps} является более удобным
решением, производящим достаточно маленькие
по размеру eps-файлы, но и \textprog{sam2p} достаточно хорош.

Опять же в архиве CTAN в директории \CTANpath{graphics/a2ping} можно взять
довольно <<увесистый>> perl-скрипт \textprog{a2ping.pl}. Этот скрипт
является своеобразной надстройкой над \textprog{sam2p} и Ghostscript,
что позволяет ему более-менее автоматически конвертировать из растра в
PostScript и обратно.

% Обзор внешних программ закончен. Далее слово <<пакет>> будет относиться
% к пакетам \LaTeX{}, а не пакетам GNU/Linux-дистрибутива.

\section{graphicx}
\label{sec:grapics:graphicx}

Ответственным за создание <<бокса>> для размещения картинки является
пакет \textpkg{graphicx}\footnote{\textpkg{graphicx} пришёл на смену
  пакету \textpkg{graphics} "--- различия в последней букве. Команды 
из~предыдущего пакета также можно использовать, но настоятельно не
  рекомендуется.}, а точнее команда \textcmd{includegraphics}:
\begin{examplenv}[0.6\textwidth]{use-graphicx-1}
% Эмблемы TeX и METAFONT, созданные 
% Дуайном Бибби, взяты со странички Д.Э.Кнута.

% Пингвина нарисовал Neal Tucker 

\includegraphics[width=\textwidth]{title.eps}

\end{examplenv}
\textcmd{textwidth} "--- ширина тела текста.\label{ex:textwidth} В
команде \textcmd{includegraphics} есть один обязательный параметр "---
вставляемая картинка. Необязательные параметры передаются с помощью
пар <<ключ>>=<<значение>>, разделяемых запятой. За подобный способ
объявления параметров отвечает пакет \textpkg{keyval}. Некоторые из
поддерживаемых пакетом параметров перечислены далее.
\begin{eqlist}
\item[\textopt{bb}] "--- позволяет исправить \textopt{BoundingBox}
  прямо в \LaTeX"=коде, не меняя eps"=файл. Значение представляет
  собой последовательность из четырёх
  чисел, кодирующую положения левого нижнего и правого верхнего углов рамки,
  например: \mbox{\textopt{[bb=127 464 430 667]}}.  Вместо одного
  \textopt{bb} можно воспользоваться четвёркой ключей, каждому из
  которых передаётся только одно значение:
  \mbox{\textopt{[bbllx=127,bblly=464,bbrx=430,bbry=667]}}.

  Кроме перечисленных ключей для модификации \textopt{BoundingBox}
  можно использовать ключ \textopt{viewport} "--- четыре числа"=значения
  описывают границы \textopt{BoundingBox}, где в качестве центра
  координат выбирается левый нижний угол уже существующего описания, и
  \textopt{trim} "--- четыре числа"=значения описывают отступы от левой,
  нижней, правой и верхней границ.
\item[\textopt{clip}] "--- обрезает вставленную картинку по
  \textopt{BoundingBox}. Это необходимо сделать в случае изменения
  границ для <<выкусывания>> части картинки, иначе она будет
  <<вылезать>> за пределы выделенного ей бокса. По умолчанию имеет
  значение \textopt{false}. Отсутствие значение у ключа \textopt{clip}
  при его упоминании эквивалентно значению \textopt{true}. Подобное
  поведение верно и для других логических переключателей.
\item[\textopt{angle}] "--- поворачивает картинку на указанный угол в градусах.
\end{eqlist}
\begin{eqlist}
\item[\textopt{origin}] "--- определяет координаты центра, вокруг которого
  вращается рисунок. Кроме непосредственно координат \textopt{origin}
  принимает и буквенные сокращения: \textopt{l}, \textopt{b}, \textopt{r}
  и \textopt{t} "--- соответствует центру вращения слева, снизу, справа
  и сверху. В этом случае выбирается середина указанной
  стороны. Возможны комбинации, задающие углы картинки: \textopt{lt},
  \textopt{rt}, \textopt{rb} и \textopt{lb}. \textopt{c} "--- означает
  центр картинки.
\item[\textopt{width}] "--- ширина вставляемой картинки.
\item[\textopt{height}] "--- высота вставляемой картинки.
\item[\textopt{scale}] "--- масштабный коэффициент.
\longitem[\textopt{keepaspectratio}] "--- логический переключатель.  Модифицирует
  параметры высоты и ширины картинки в сторону уменьшения с целью
  сохранения естественных пропорций картинки.
\end{eqlist}

\begin{examplenv}[0.6\textwidth]{use-graphicx-2}
\includegraphics[trim=110 0 105 100,clip, 
            width=0.49\textwidth]{title.eps}
\hspace{0.5cm}
\includegraphics[viewport=0 0 100 200,clip, 
              width=0.49\textwidth,
              height=3cm,keepaspectratio,
              angle=180,origin=c]{title.eps}
\end{examplenv}

\Note{} Аргументы \textcmd{includegraphics} интерпретируются слева
направо. Для команд вращения и масштабирования порядок следования
\emph{имеет} значение.


\subsection{Определение своих правил}
\label{sec:graphicx:declaregraphicsrule}

Пакет \textpkg{graphicx} предоставляет возможность перед вставкой
картинки вызвать внешнюю программу для её обработки. Например, так
можно добавить возможность включения в документ png-файлов:
\begin{lstlisting}
\DeclareGraphicsRule{.png}{eps}{.bb}{`bmeps -p3 -c #1} 

\end{lstlisting}
Первый параметр определяет расширение нового формата графики, для
которого задаются правила. В представленном примере это
png"=файл. Второй параметр указывает тип графики, который передаётся
непосредственно \LaTeX.  В данном примере гарантируется, что после
преобразования это будет полноценный eps или En\-capsulated PostScript,
что необходимо, так как \textprog{dvips} по умолчанию ничего другого и
не знает. Третий параметр определяет расширение файла, откуда можно извлечь
параметры \textopt{BoundingBox}, то есть файл с расширением
\textext{bb} должен содержать строку вида:
\begin{lstlisting}[language=Clean]
%%BoundingBox: 0 0 848 979

\end{lstlisting}

До вставки для каждой png-картинки необходимо создать такой файл,
например, следующим образом:
\begin{lstlisting}[language=bash,frame=]
> bmeps -b |<<картинка>>|.png |<<картинка>>|.bb

\end{lstlisting}

Последний параметр определяет команду, которую следует выполнить для
преобразования картинки. Команда должна выдавать результат на
стандартный вывод.  \textopt{\#1} соответствует имени обрабатываемого
файла. Непосредственное выполнение команды происходит при трансляции
dvi"=файла.

\Note{} Выполнение внешней команды является потенциально
\emph{опасной} процедурой, поэтому защита по умолчанию этого не
позволяет. Например, для просмотра dvi"=файла через \textprog{xdvi}
следует использовать ключ \textopt{-allowshell}. В противном случае
будет выдаваться запрос на исполнение команды каждый раз, когда
встречается вставка по новым правилам. Для преобразования в PostScript
в случае \textprog{dvips} также следует отключить защиту с помощью
ключа \textopt{-R0}.  Лучше всё"=таки по~возможности избегать
описанной процедуры и сразу готовить картинки в eps"=формате.

Для трактования всех неизвестных драйверу расширений как eps следует
применить команду:
\begin{lstlisting}
\DeclareGraphicsRule{*}{eps}{*}{} 

\end{lstlisting}
Это полезно в случае вставки картинок MetaPost, которые по умолчанию
не имеют расширений. Если третий параметр равен <<звёздочке>>, то это
означает, что \textopt{BoundingBox} следует искать в том же файле, что
и графику.



\section{Плавающие объекты}
\label{sec:graphics:floats}

%\fxnote{Глава 6 путеводителя 2 стр 283 - про это}

Мало просто поместить картинку "--- её надо разместить красиво. При
этом всё должно делаться автоматически с минимальным вмешательством со
стороны автора. Просто \textcmd{includegraphics} для этого дела не
очень подходит, так как размещение регулируется исключительно
пользователем. Чтобы автоматизировать размещение рисунка, в \LaTeX{} имеется специальная сущность:
\emph{плавающий объект} (float\footnote{Пакет, который позволяет
  создавать новые типы плавающих объектов, так и называется
  \textpkg{float}. Более современная версия этого пакета написана
  Ольгой Лапко и называется  \textpkg{floatraw}.}). Если для
этого объекта нет места на текущей странице, то он переносится на
следующую.  Для размещения картинок стандартные классы определяют
плавающий объект как окружение \textenv{figure}:
\begin{lstlisting}
\begin{figure}[ht]
  \centering % Центрируем картинку
  \includegraphics{|<<картинка>>|}
  \caption{|<<подпись>>|}\label{fig:metka}
\end{figure}

\end{lstlisting}

В качестве необязательного параметра окружению \textenv{figure} можно
передать допустимые способы размещения плавающего объекта:
\begin{eqlist*}
\item[\textopt{h}] "--- разместить по возможности здесь же,
\item[\textopt{t}] "--- разместить в верхней части страницы,
\item[\textopt{b}] "--- разместить в нижней части страницы,
\item[\textopt{p}] "--- разместить на отдельной странице, где нет ничего кроме
  плавающих объектов.
\end{eqlist*}

Приоритет для размещения \textenv{figure} определяется порядком
следования букв. Если первой следует буква \textopt{h}, а второй
\textopt{t} или \textopt{b}, то в случае неудачи \LaTeX{} размещает
плавающий объект в верхней или нижней части  \emph{следующей}
страницы соответственно.

Для <<красивого>> размещения картинок \LaTeX{} опирается на некоторые
значения по умолчанию, которые не всегда для текущего случая могут
быть оптимальными. Поэтому если очень хочется разместить картинку,
например, внизу, то пожелание можно усилить с помощью восклицательного
знака: \textopt{[b!]}.




\subsection{Управление плавающими объектами}
\label{sec:graphics:float-control}

Если плавающих объектов в документе немного, то всё будет хорошо без
какого-либо вмешательства человека. Но если их много, то так или иначе
надо будет управлять их размещением.



% \subsubsection*{Инструкции и запреты}
% \label{sec:graphics:float-control:clear}


\subsubsection{clearpage}
Если \LaTeX{} не справляется с размещением картинок, то он переносит
их на следующую страницу. В какой-то момент может накопиться целая
<<толпа>> таких перенесённых картинок и возникнет необходимость в их
<<насильственном>> выводе в каком-то определённом месте. Для этого
существует команда \textcmd{clearpage}. При вызове этой команды
завершается текущая страница, выводятся все отложенные плавающие
объекты, и только потом продолжается обычный вывод текста. Единственная
проблема этой команды в том, что текущая страница по ней
обрывается. Чтобы избежать обрыва, можно воспользоваться пакетом
\textpkg{afterpage}, точнее одноимённой командой из него:
\begin{lstlisting}
\afterpage{\clearpage}

\end{lstlisting}

Команда \textcmd{afterpage} откладывает выполнение указанных в ней
инструкций до~конца текущей страницы.


\subsubsection{suppressfloats}
Команда \textcmd{suppressfloats} полностью подавляет размещение
плавающих объектов на текущей странице. В качестве необязательного
параметра ей можно передать \textopt{t} или \textopt{b} "--- в этом
случае запрет распространяется только на размещение плавающих объектов
вверху или внизу страницы соответственно.



\subsubsection{placeins}
Пакет \textpkg{placeins} не даёт <<утекать>> плавающим объектам за
установленные пределы. Барьер устанавливается с помощью команды
\textcmd{FloatBarrier}. 

Это бывает полезно, когда хочется, чтобы все картинки не выходили за
пределы своего раздела. В этом случае следует переопределить нужную
команду секционирования для установки перед ней барьеров. В случае
команды секционирования раздела (\textcount{section}) достаточно передать
опцию \textopt{[section]} пакету при загрузке:
\begin{lstlisting}
\usepackage[section]{placeins}

\end{lstlisting}


\subsubsection{endfloat} Часто при подготовке статей требуют их размещения
после текста на отдельных страницах, предваряя эту галерею списком
иллюстраций. Пакет \textpkg{endfloat} именно это и делает. Достаточно
его загрузить.


\subsection{<<Упаковка>> картинок в один float}
\label{sec:graphics:float-collect}

Для уменьшения <<поголовья>> плавающих объектов полезно размещать
картинки группами. Например, чтобы разместить две картинки рядом, можно
применить команду \textcmd{parbox} или окружение \textenv{minipage}:
\begin{lstlisting}
\parbox[|<<позиционирование>>|]{|<<ширина>>|}{|<<текст>>|}

\begin{minipage}[|<<позиционирование>>|]{|<<ширина>>|}
 |текст|
\end{minipage}

\end{lstlisting}
В обоих случаях есть обязательный параметр <<ширина>>, по которой
формируется создаваемый бокс и необязательный <<позиционирование>>
"--- расположение сформированного бокса относительно базовой линии по
вертикали. Позиционирование может проводиться по центру (опция
\textopt{[c]} "--- верно по умолчанию), по~верхней линии (\textopt{[t]})
и по нижней линии бокса (\textopt{[b]}). Шаблон для двух рядом стоящих
рисунков может иметь примерно следующий вид:
\begin{lstlisting}
\begin{figure}[ht]\centering
  \parbox[b]{0.49\textwidth}{\centering 
    \includegraphics{|<<рисунок-1>>|}
    \caption{|<<подпись-1>>|}\label{fig:metka-1}}
  \hfil\hfil%раздвигаем боксы по горизонтали
  \begin{minipage}[b]{0.49\textwidth}
    \centering 
    \includegraphics{|<<рисунок-2>>|}
    \caption{|<<подпись-2>>|}\label{fig:metka-2}
  \end{minipage} 
\end{figure}

\end{lstlisting}
Использование команды \textcmd{parbox} или окружения
\textenv{minipage} зависит исключительно от личных предпочтений. С
их помощью можно организовать и более сложные конструкции.

Для целей автоматизации упаковки можно использовать и
специализированные пакеты.
\begin{eqlist*}
\item[\textpkg{subfig}] "--- организует группы из множества
  картинок. Относительно современный пакет.
\longitem[\textpkg{miniplot}] "--- делает то же самое, что и
  \textpkg{subfig}, хоть и менее изощрённо.
\item[\textpkg{figsize}] "--- специализируется на автоматическом вычислении
  размеров картинок для размещения их в указанных пределах.
\item[\textpkg{dpfloat}] "--- определяет новый тип плавающего окружения,
  занимающего сразу две страницы. Двойные иллюстрации на развороте.
\end{eqlist*}
%\newpage

\subsection{Картинки <<в оборку>>}
\label{sec:graphics:textandfloats}


%здесь привести пример рисунка в оборку wrapfigure.eps

\begin{floatingfigure}{0.53\textwidth}
\centering    
 \includegraphics[width=0.5\textwidth]{graphics/wrapfigure.eps}
 \caption{Картинка в оборку.}
\end{floatingfigure}


Маленькие иллюстративные рисунки удобно делать в оборку с текстом,
то есть текст должен обтекать их. Такие картинки располагаются на
внешней стороне страницы, то есть слева для чётных, а справа для
нечётных страниц или в случае одностороннего режима печати.


Традиционно разбираются два пакета для создания подобных рисунков "---
это \textpkg{floatflt} и \textpkg{wrapfig}. Заметим, что 
\textpkg{floatflt} более автоматизирован для размещения картинок, но
он также чаще <<ломается>> при большом числе плавающих
объектов. Возможны даже <<потери>> картинок. Эти пакеты
определяют окружения \textenv{floatingfigure} и \textenv{wrapfigure}
соответственно.

\begin{lstlisting}
\begin{floatingfigure}[|<<размещение>>|]{|<<ширина>>|}
  |\ldots|
\end{floatingfigure}

\end{lstlisting}
\longpage

Необязательный параметр <<размещение>> окружения
\textenv{floatingfigure} позволяет изменить алгоритм размещения
картинки:
\begin{eqlist*}
\item[\textopt{rflt}] "--- размещать справа,
\item[\textopt{lflt}] "--- размещать слева,
\item[\textopt{vflt}] "--- слева для чётных и справа для нечётных страниц (по
  умолчанию).
\end{eqlist*}

Окружение \textenv{wrapfigure} имеет следующую структуру:
\begin{lstlisting}
\begin{wrapfigure}[|<<число строк в оборке>>|]
                  {|<<размещение>>|}{|<<ширина>>|}
  |\ldots|
\end{wrapfigure}

\end{lstlisting}

В отличие от \textenv{floatingfigure} окружение \textenv{wrapfigure}
требует определить правила размещения картинки в обязательном
порядке. Доступные варианты: 
\begin{eqlist*}
\item[\textopt{r}] "--- размещать справа,
\item[\textopt{l}] "--- размещать слева,
\item[\textopt{i}] "--- размещать с внешней стороны страницы,
\item[\textopt{o}] "--- размещать с внутренней стороны страницы.
\end{eqlist*}
Если вместо строчных букв передать заглавные, то включается запрет на
сдвиг по вертикали "--- картинка должна быть размещена, начиная с той
строки абзаца, в которой она была определена.

Необязательный параметр <<число строк в оборке>> позволяет указать
число строк текста, которые должны быть сбоку от картинки. При этом выносная
формула считается за три строки текста. Если параметр не определён, то
число строк вычисляется автоматически, к сожалению, не всегда
оптимально.

Свою процедуру размещения картинки в оборку с текстом предлагает также 
и пакет \textpkg{nccfloats} из коллекции \textpkg{ncctools},
созданной  А.\,И.~Роженко:
\begin{lstlisting}
\sidefig(|<<ширина картинки>>|)(|<<ширина текста>>|)
{\includegraphics{|<<картинка>>|}}{|<<текст>>|}

\end{lstlisting}
В этом случае предлагается передавать команде \textcmd{sidefig} и
саму картинку и текст, помещаемый сбоку. Параметр <<ширина текста>>
можно опустить. Тогда текст занимает всё оставшееся
пространство. Подробности в \textfile{nccfloats.pdf}.


\subsection{Подписи к рисункам}
\label{sec:graphics:caption}


Для добавление подписи к рисунку используется команда
\textcmd{caption}, которую можно применять только внутри
плавающих объектов. В качестве обязательного параметра передаётся
текст подписи. При выводе подпись центрируется, если она достаточно
мала. В противном случае подпись оформляется в виде абзаца. Текст
подписи не должен содержать команд разрыва строки. Все хрупкие команды
внутри подписи должны быть защищены с помощью команды
\textcmd{protect}. \textcmd{caption} можно передать также
необязательный параметр, который должен представлять собой краткую
версию подписи, появляющуюся в автоматически создаваемых списках.

Оформление подписи жёстко привязано к стилю документа, и изменить её
без переопределения самой команды \textcmd{caption} не просто. Для
модификации параметров следует воспользоваться пакетами
\textpkg{caption} или \textpkg{ccaption}. Документация в~\textfile{caption.pdf} и
\textfile{ccaption.pdf} соответственно.

\mindex{русификация!подпись к рисунку}

При включении  поддержки русского языка
\lstinline!\usepackage[russian]{babel}!
перед подписью выводится слово <<Рис.>>, за которым идёт автоматически
вычисляемый порядковый номер картинки. В качестве разделителя между
счётчиком и подписью по~умолчанию используется двоеточие. Для замены
двоеточия на точку в преамбуле достаточно набрать, например,
следующее:
\begin{lstlisting}
\usepackage{ccaption}
% заменяем для рисунков ':' после номера рисунка на '.'
\captiondelim{. } % после точки стоит пробел!

\end{lstlisting}


Кроме традиционного размещения подписи под картинками, подпись можно
вынести, например, на поля страницы. Недаром же стандартные классы
имеют такие широкие поля. Пакет \textpkg{mcaption} определяет окружение
\textenv{margincap}:
\begin{lstlisting}
\begin{figure}[ht]
  \begin{margincap}{|<<Подпись>>|}
    \includegraphics{|<<картинка>>|}
  \end{margincap}
\end{figure}

\end{lstlisting}   

В качестве обязательного параметра окружению передаётся подпись, а
внутри определяется картинка. Подробности в \textfile{mcaption.pdf}.
%\smallskip


% \section{Заключение}
% \label{sec:graphics:afterwords}

% \Note Странный получился рассказ. В статье, имеющей заголовок <<Графика>> не
% было ни слова сказано о том, как эту графику, собственно говоря,
% создавать. А ведь \emph{есть} что сказать, но в данном случае
% информация о размещении и оформлении готовых картинок поважнее
% будет. Но и о том, как \LaTeX{} умеет рисовать тоже будет рассказано,
% но чуть попозже.


\endinput



Как врезка? Автор Александр Цыплаков "--- всё на Delphy.


xchm "--- для просмотра текста


%%% Local Variables: 
%%% coding: koi8-r
%%% mode: latex
%%% TeX-master: "../ctex"
%%% End: 
