%  -*- coding: koi8-r -*-


\chapter{Справочно-поисковый аппарат издания}
\label{cha:apparatus}

{\setlength{\epigraphwidth}{0.61\textwidth} \epigraph{На этом же этаже
    располагалось книгохранилище. По поводу его размеров рассказывали,
    что в глубине, в полукилометре от входа, идёт вдоль стеллажей
    неплохое шоссе, оснащённое верстовыми столбами.}{\emph{<<Понедельник
    начинается в субботу>> \\Аркадий и Борис Стругацкие}}}

% По-моему, обязательно следовало бы упомянуть в разделе про BibTeX про замечательный "пакет" makebst.tex для создания bst файлов. Для новичков, не желающих разбираться с заковыристым языком bst-файлов, незаменимая вещь.

% latex makebst.tex, отвечаем на пару вопросов и вуаля




Книги делятся на те, что читаются один раз, и те, что многократно
перечитываются. Наличие информации о структуре книги повышает ценность
любого текста. Отсутствие этой информации "--- прямой намёк, что после
прочтения произведение следует забыть и выбросить.

Справочно-поисковый аппарат издания позволяет читателю облегчить и
убыстрить поиск имеющихся в книге объектов. В качестве элементов, из
которых складывается справочного"=поисковая система, можно упомянуть
рубрикацию, оглавление, колонтитулы, ссылки, подстрочные примечания,
алфавитный указатель и библиографию.

Этот аппарат существует исключительно для читателя, и он достаточно
трудоёмок при создании. Но сложности не должны пугать истинных
энтузиастов в~деле создания текстов, так как их преодоление
значительно повышает ценность серьёзного произведения.




\section{Оглавление}
\label{sec:apparatus:section}

% {\setlength{\epigraphwidth}{0.6\textwidth} \epigraph{Нужны ли книге
%     оглавление или содержание? Любой скажет: что за вопрос, конечно,
%     нужны. И не только в книге научной и деловой. В
%     любой.}{А.Э.\,Мильчин <<Культура издания>>}}


\textcmd{tableofcontents} (toc"=файл) "--- стандартная
команда \LaTeX{} для создания оглавления.  Кроме оглавления также можно
вывести список иллюстраций \textcmd{listoffigures}
(lof"=файл) и таблиц \textcmd{listoftables}
(lot"=файл). На основе чего формируется само оглавление,
подробно описано в разделе~\ref{sec:base2:section}.

Для добавления какого-либо текста в оглавление можно воспользоваться
командой \textcmd{addtocontents}\lstinline!{toc}{текст}!. Вместо
\textopt{toc} (оглавление) можно указать \textopt{lof} (список
иллюстраций) или \textopt{lot} (список таблиц). Текст может содержать
команды, но их лучше защитить с помощью макроса \textcmd{protect}, на
случай если они окажутся хрупкими.

\subsubsection{shorttoc}
\label{sec:apparatus:shorttoc}

В больших документах полезно перед полным оглавлением иметь его
краткую менее подробную версию. Пакет \textpkg{shorttoc} добавляет
команду:\textcmdh{shorttableofcontents}
\begin{lstlisting}
\shorttableofcontents{Краткое оглавление}{1}
\end{lstlisting}
Первый параметр макроса "--- это заголовок оглавления, а второй
параметр "--- глубина оглавления. В случае этой команды будет
напечатано оглавление вплоть до разделов (\textcmd{section}), которые
имеют уровень 1. Уровень обычного оглавления можно менять,
переопределив счётчик \textcount{tocdepth}.


\subsubsection{tocloft}
\label{sec:apparatus:tocloft}

По тем или иным причинам можно быть недовольным оформлением
оглавления. Пакет \textpkg{tocloft} даёт доступ ко всем <<ручкам>>,
которые можно покрутить, чтобы придать оглавлению достойный
вид. Многочисленные подробности обретаются в файле
\textfile{tocloft.pdf}. При чтении документации следует учитывать, что
если в~имени команды встречается заглавная \textopt{Z}, то это сокращение для
\textopt{toc} or \textopt{lof} или  \textopt{lot}, а если заглавная
\textopt{X} "--- сокращение \textopt{part},  \textopt{chap}, \textopt{sec},
\textopt{subsec}, \textopt{subsubsec}, \textopt{fig},  \textopt{tab} и
тому подобное. Например, так можно увеличить промежуток, который
выделяется на печать номера раздела в оглавлении:
\textcmdh{cftsecnumwidth}
\begin{lstlisting}
\addtolength{\cftsecnumwidth}{1ex}
\end{lstlisting}
а так, чтобы вместо точек расстояние между названием и номером страницы (лидеры)
заполняли звёздочки:
\textcmdh{cftdot}
\begin{lstlisting}
\renewcommand{\cftdot}{\ensuremath{\ast}}
\end{lstlisting} 
Таким образом можно добавить лидеры для глав:
\textcmdh{cftchapleader}
\textcmdh{cftdotfill}
\textcmdh{cftchapdotsep}
\textcmdh{cftchapdotsep}
\textcmdh{cftdotsep}
\begin{lstlisting}
\renewcommand{\cftchapleader}{\cftdotfill{\cftchapdotsep}}
\renewcommand{\cftchapdotsep}{\cftdotsep}
\end{lstlisting} 

\subsubsection{tocbibind}
\label{sec:apparatus:tocbibind}

По умолчанию в оглавлении нет ссылок на библиографию и предметный
указатель\footnote{В классах \textpkg{KOMA-Script} это решается с
  помощью дополнительных опций \textopt{bibtotoc} и \textopt{idxtotoc}
  для библиографии и указателя соответственно.}. Конечно несложно
добавить эти элементы с помощью \textcmd{addcontentsline}, но,
возможно, проще это сделать с помощью специально для этого написанного
пакета \textpkg{tocbibind}. При загрузке пакету \textpkg{tocbibind}
можно передать следующие опции:
\begin{eqlist}
\item[\textopt{notbib}] "--- не добавлять ссылку на библиографию;
\item[\textopt{notindex}] "--- не добавлять ссылку на указатель;
\item[\textopt{nottoc}] "--- не добавлять ссылку на оглавление;
\item[\textopt{notlot}] "--- не добавлять ссылку на список иллюстраций;
\item[\textopt{notlof}] "--- не добавлять ссылку на список таблиц;
\item[\textopt{chapter}] "--- если это возможно, ссылки оформлять так же, как главы;
\item[\textopt{section}] "--- если это возможно, ссылки оформлять так же,
  как разделы;
\item[\textopt{numbib}] "--- библиография тоже нумеруется, как и главы;
\item[\textopt{numindex}] "--- указатель тоже нумеруется, как и главы;
\item[\textopt{none}] "--- полностью отключить всё, что было добавлено
  при загрузке пакета.
\end{eqlist}

Подробности можно найти в файле документации \textfile{tocbibind.pdf}.

\subsubsection{minitoc}
\label{sec:apparatus:minitoc}

Если же хочется сделать из оглавление нечто изощрённое, то пакет
\textpkg{minitoc} с его более чем 6 сотнями страниц документации
поможет на этом пути. Пакет позволяет сделать для каждой главы своё
оглавление:
\textcmdh{dominitoc}
\textcmdh{dominilof}
\textcmdh{dominilot}
\textcmdh{minitoc}
\textcmdh{minilof}
\textcmdh{minilot}
\textcmdh{mtcskip}
\begin{lstlisting}
\dominitoc % формирование оглавления на уровне главы
\dominilof % формирование списка иллюстрации на уровне главы
\dominilot % формирование списка таблиц на уровне главы
\tableofcontents % обычное оглавление
\listoffigures   % обычный список иллюстраций
\listoftables    % обычный список таблиц  

|\bs|chapter{Новая глава}
\minitoc % оглавление для этой главы
\mtcskip
\minilof % список иллюстраций для этой главы
\mtcskip
\minilot % список таблиц для этой главы
\end{lstlisting}

Подробности изложены в файле документации \textfile{minitoc.pdf}.

\section{Колонтитулы}
\label{sec:colontitles}

Правила формирования колонтитулов целиком зависят от выбранного класса
документа. Если же хочется изменить значения по умолчанию, то проще
всего выбрать стиль страницы myheadings и сформировать колонтитулы:
\begin{lstlisting}[]
\pagestyle{myheadings} 
\markboth{|<<левый колонтитул>>|}{|<<правый колонтитул>>|} 

\end{lstlisting}

Если печать односторонняя, то достаточно воспользоваться командой
\textcmd{markright}, которая имеет только один аргумент.  Для полного
управления содержимым колонтитулов лучше всего подходит пакет
\textpkg{fancyhdr}.


\subsubsection{fancyhdr}
\label{sec:apparatus:fancyhdr}
Чтобы воспользоваться возможностями пакета, необходимо загрузить
стилевой файл и с помощью \textcmd{pagestyle} выбрать стиль. 

\begin{figure}[h]
  \centering%центрируем картинку
  \includegraphics[width=0.7\textwidth]{apparatus/make-up-fancyhdr.eps}
  \caption{Заполняем колонтитулы с помощью \textpkg{fancyhdr}}
  \label{fig:apparatus:fancyhdr}
\end{figure}

Пакет \textpkg{fancyhdr} позволяет управлять содержимым
колонтитула. Возможности: верхний и нижний колонтитул разбивается на
три независимых части, многострочные колонтитулы, колонтитулы,
вылезающие по ширине за \textcmd{textwidth}, декоративные линейки,
разные колонтитулы для чётных и нечётных страниц, отдельные
колонтитулы для специальных полос (начала глав, страницы, отведённые
под плавающие объекты). Простейший пример для определения колонтитулов
с~помощью \textpkg{fancyhdr}:
\begin{lstlisting}[]
\usepackage{fancyhdr} 
  |\ldots|
|\bs|begin{document}
\pagestyle{empty} % Очищаем стиль страницы 
\pagestyle{fancy} % Включаем пользовательский стиль
\lhead{А.В.Тор}   % Верхний колонтитул слева 
\chead{---~\arabic{page}~---} % Там же по центру
\rhead{Статья}    % Верхний колонтитул справа
% Аналогично для оформления нижнего колонтитула 
\cfoot{---~\roman{page}~---} 
\lfoot{\hspace{0.7cm}Это просто демонстрация} 
\rfoot{возможностей \textbf{fancyheadings}} 

\end{lstlisting}

Результат компиляции примера представлен на рис.~\ref{fig:apparatus:fancyhdr}.
Переменная \textopt{page} содержит номер страницы. 

Для того чтобы задать колонтитулы на чётных/нечётных страницах для
двухсторонней печати, необходимо воспользоваться необязательным
параметром команд, например:
\begin{lstlisting}[]
\rhead[чётный колонтитул]{нечётный колонтитул}
\end{lstlisting}

Если необязательный параметр отсутствует, то для чётных страниц
используется тот же колонтитул, что и для нечётных.


Подробности о том, что можно сотворить с колонтитулами, следует искать 
в~документации к пакету \textfile{fancyhdr.pdf}.


\subsubsection{nccfancyhdr}
\label{sec:apparatus:nccfancyhdr}

\textpkg{nccfancyhdr} из пакета \textpkg{ncctools} является более
современной и качественной реализацией \textpkg{fancyhdr}. При
загрузке стиля \textpkg{nccfancyhdr} содержимое колонтитулов можно
задавать теми же командами, что и в \textpkg{fancyhdr}. Подробная и
исчерпывающая документация в файле \textfile{nccfancyhdr.pdf} позволит
узнать, как создавать свои стили страницы, как задавать стили страницы,
где размещаются иллюстрации, как создать разделительную линию между
текстовым полем и колонтитулом, а также многое другое.


\subsubsection{technics}
\label{sec:apparatus:technics}

\begin{figure}[t]
  \centering%центрируем картинку
  \fbox{\includegraphics[width=0.7\textwidth]{apparatus/make-up-technics.eps}}
  \caption{Рамочка от \textpkg{technics}}\label{fig:apparatus:technics}
\end{figure}

Одним из примеров использования пакета \textpkg{fancyhdr} является
стиль \textpkg{technics}. Он переопределяет колонтитулы, чтобы
получить стандартную рамку для стандартных корпоративных
документов. Пример такой рамки можно увидеть 
на~рисунке~\ref{fig:apparatus:technics}.


Без подготовки пользоваться этим стилем нельзя. 
Чтобы его можно было использовать с
кириллицей, необходимо как минимум закомментировать строку 
с~\textpkg{inputenc}. Этот стиль следует рассматривать исключительно как
пример работы с  \textpkg{fancyhdr}, благо файл
\textfile{technics.sty} относительно небольшой.

\section{Библиография}
\label{sec:apparatus:bibliography}

% {\setlength{\epigraphwidth}{0.5\textwidth} \epigraph{Книги создаются
%     не в безвоздушном, или бескнижном, пространстве.}{А.Э.\,Мильчин
%     <<Культура издания>>}}

Хорошая книга представляет собой ценность. Но даже  лучшая
книга не в~состоянии охватить абсолютно все аспекты рассматриваемой в
ней темы. Книги существуют в книжном пространстве. Всегда можно найти
что-то, на чём книга основывалась, что-то, что развивает основную идею, и
что-то, что позволяет взглянуть на главную тему с другой
стороны. Список литературы книгу только украшает.


Для ссылок на литературу используется команда \textcmdh{cite}
\begin{lstlisting}[]
\cite[|<<комментарий>>|]{|<<список меток>>|}

\end{lstlisting}

Метки формируются с помощью  механизма \BibTeX{},
рассмотренного в разделе~\ref{sec:apparatus:bibtex}, либо добавляются
 внутри окружения \textenv{thebibliography}:
\textcmdh{bibitem}
\begin{lstlisting}[]
Полезно почитать книгу \cite[Роженко]{rozenko-2005}.

\begin{thebibliography}{9}
\bibitem{rozenko-2005}Роженко А.И. Искусство верстки в 
\LaTeX'е. \newblock --- Новосибирск: Изд. ИВМиМГ СО~РАН, 
2005. 398~с.
\end{thebibliography}

\end{lstlisting}

 Команда \textcmd{newblock}
позволяет логически разделить разные по смыслу элементы. В качестве
обязательного аргумента окружения \textenv{thebibliography} требуется
передать текст, соответствующий самой широкой метки для
выравнивания. То~есть, если список литературы содержит меньше 10
записей, достаточно передать однобуквенную фразу, например, <<9>>,
а в случае двузначного числа книг в списке, уже потребуется <<99>> и
так далее.


По умолчанию в тексте не может быть более одного окружения
\textenv{thebibliography}. В случае необходимости эту проблему можно
обойти, загрузив пакет \textpkg{compactbib}. Нумерация элементов при
этом остаётся сквозной. Вертикальные пробелы между элементами
несколько уменьшаются по сравнению с умолчанием.



\begin{figure}[t]
  \centering
  \fbox{\includegraphics[width=\linewidth]{apparatus/apparatus-bib.eps}}
  \caption{Пример библиографической ссылки}
  \label{fig:apparatus:bib}
\end{figure}


Как и в случае с перекрёстными ссылками, информация о списке литературы
заносится в файл с расширением \textext{aux}. То есть для правильного его
отображения необходимо два прохода \LaTeX.


В одной команде \textcmd{cite} можно перечислить несколько меток
через запятую, например, так выглядит ссылка на книги по \LaTeX{}
русских авторов
\cite{Lvovskij-2003,Kotelnikov-2004,Rozhenko-2005}:
\begin{lstlisting}
\cite{Lvovskij-2003,Kotelnikov-2004,Rozhenko-2005}
\end{lstlisting}
Временами при большом количестве цитируемой литературы эти ссылки
могут разрастаться. Для того чтобы слишком большие списки могли
автоматически переноситься на следующую строку, можно воспользоваться
стилем \textpkg{breakcites} из пакета \textpkg{ltxmisc}.



В дополнение к команде цитирования \textcmd{cite} в случае
подключения библиографической базы можно использовать инструкцию
\textcmd{nocite}. Команда \textcmd{nocite} не создаёт никакой
ссылки в тексте, но упомянутая запись отображается в списке
литературы.

\mindex{русификация!библиографические метки}
\Note Для того чтобы можно было использовать кириллицу в метках для
цитирования литературы, а именно иметь возможность написать что-то
вроде:
\begin{lstlisting}[]
\cite{Котельников-2004}
 |\ldots|
\bibitem{Котельников-2004}

\end{lstlisting}
следует воспользоваться пакетом \textpkg{citehack}:
\begin{lstlisting}[]
\usepackage{citehack} 

\end{lstlisting}
Из названия пакета очевидно, что это <<хак>> со всеми вытекающими последствиями, то есть
не следует им особо злоупотреблять.




\section{Работаем с \BibTeXbf}
\label{sec:apparatus:bibtex}

\begin{figure}[t]
  \centering
  \includegraphics[width=0.4\textwidth]{apparatus/apparatus-1}
  \caption{Конвейер \LaTeX+\BibTeX: tex "--- \LaTeX-исходник, bib "---
    библиографическая база, bst "--- стилевой файл для библиографии,
    blg "--- log-файл \BibTeX, bbl "--- отсортированный список
    литературы, aux "--- информация о ссылках}
  \label{fig:apparatus:bibtexandlatex}
\end{figure}

Можно список литературы оформлять руками. Есть какой-никакой стандарт,
например, тот же ГОСТ~7.80-00\footnote{ГОСТ на оформление
  библиографического указателя, принятый в 2000 году. Правила
  оформления могут нравиться или не нравится, но это всё-таки хоть
  какой-то стандарт.} или ГОСТ~7.1-84\footnote{Устарел после выхода
  ГОСТ~7.1-2003. Необходима доработка этого стиля.}. Берём и просто
следуем подробной инструкции. Но далеко не все издательства
подчиняются этому стандарту, в котором, например, нет информации, как
нужно оформлять www"=ссылки. Да и вообще список сопутствующей
литературы "--- это нечто большее, чем просто довесок к статье или
книге, это вполне самостоятельный фрагмент информации, который очень
полезно уметь представлять по"=разному.

Для решения этой проблемы Орен Поташник разработал программу
\BibTeX{}, которая сама формирует окружение \textenv{thebibliography},
получая информацию из~текстовой библиографической базы. Структура
библиографической базы \BibTeX{} является довольно распространённым
форматом, который использует в том числе и Google Scholar
(\url{http://scholar.google.com/}), не говоря уж о том, что основной
архив доступных электронных препринтов \url{http://arxiv.org}
предоставляет библиографическую информацию исключительно в виде
записей \BibTeX.

%можно использовать как врезку
\Note Из программного обеспечения, позволяющего работать с \BibTeX, следует
упомянуть встроенный в \textprog{Emacs} пакет \textprog{RefTeX} и
\textprog{JabRef}.  

\Note Тот, кто не освоил \textprog{Emacs} и кому не нравится Java, может
поискать программные пакеты \textprog{gBib} и \textprog{KBib} для
Gnome и KDE соответственно. Простой конвертер \textprog{bibtex2html}
позволяет получить список литературы и html-виде. Естественно, и
простое редактирование текстового файла руками также никто не
отменял.

\begin{figure}[t]
  \centering
  \fbox{\includegraphics[width=\linewidth]{apparatus/apparatus-bib2.eps}}
  \caption{Список литературы, оформленный с помощью стиля
    \textpkg{gost2008}}
  \label{fig:apparatus:bib2}
\end{figure}

Как правило, библиографическая база в формате \BibTeX{} хранится в
файле с~расширением \textext{bib}. Перед тем как с помощью команды
\textcmd{bibliography}  подключить базу к \LaTeX"=исходнику, нужно
выбрать стиль сортировки библиографии:
\begin{lstlisting}[]
\bibliographystyle{|<<стиль>>|}
\bibliography{|<<имя bib-файла без расширения>>|}

\end{lstlisting}

Теперь можно скомпилировать сам текст:
\begin{lstlisting}[language=bash,frame=]
> latex mybook.tex
> bibtex mybook
> latex mybook.tex

\end{lstlisting}

Информация о том, какой именно bib"=файл используется, сохраняется в
aux"=файле при первой компиляции с помощью \textprog{latex}. 

В \LaTeX{} есть четыре стандартных стиля для оформления списка литературы.
\begin{eqlist}
\item[\textbf{plain}] "--- открытый стиль. Библиографические записи помечаются
  порядковыми номерами и сортируются в алфавитном порядке. Чтобы
  правильно отсортировать библиографию на русском языке, необходимо
  вместо \textprog{bibtex} воспользоваться командой \textprog{bibtex8},
  указав с помощью ключа \textopt{-{}-csfile} соответствующее правило
  сортировки\footnote{В стандартной поставке \LaTeX{} есть правило 
    сортировки для кодовой страницы cp866 \textfile{cp866rus.csf}. На
    основе этого файла можно создать правило для другой кодовой
    страницы.}.
\item[\textbf{unsrt}] "--- несортирующий стиль. В отличие от \textbf{plain}
  порядок представления списка литературы определяется порядком
  цитирования библиографии в~тексте.
\item[\textbf{alpha}] "--- алфавитный стиль. Вместо нумерации библиографии
  используются имена меток. Литература сортируется по меткам.
\item[\textbf{abbrv}] "--- аббревиатурный стиль. Вместо полных имён авторов,
  названий месяцев и журналов печатаются сокращения. Сортировка и
  нумерация соответствует стилю \textbf{plain}.
\end{eqlist}

% Максим Поляков разработал стили для \BibTeX, соответствующие
% \mbox{ГОСТ~7.80-00} и ГОСТ~7.1-84: \textbf{gost780s}/\textbf{gost71s},
% аналогичные \textbf{plain}, и \textbf{gost780u}/\textbf{gost71u},
% аналогичные \textbf{unsrt}. Описание этих стилей представлено в
% стандартной документации в виде файлов \textfile{gost780.pdf} и
% \textfile{gost71.pdf}.  

\textpkgh{gost} 

Игорь А. Котельников разработал стили для \BibTeX, соответствующие
ГОСТ 7.0.5-2008 (Библиографическая ссылка. Общие требования и правила
составления.), ГОСТ~7.1-2003 (Библиографическая
запись. Библиографическое описание. Общие требования и правила
составления.), ГОСТ~7.80-2000 (Библиографическая запись. Заголовок.
Общие требования и правила составления.), ГОСТ~7.11-2004 (Система
стандартов по информации, библиотечному и издательскому
делу. Библиографическая запись. Сокращение слов и словосочетаний на
иностранных европейских языках) и ГОСТ~7.83-2001 (Электронные издания.
Основные виды и выходные сведения.):
\textbf{gost2003s}/\textbf{gost2008s}, аналогичные \textbf{plain}, и
\textbf{gost2003}/ \textbf{gost2008}, аналогичные
\textbf{unsrt}. Информацию по этим библиографическим стилям можно
найти в директории \textpath{texmf-dist/doc/bibtex/gost} в файлах
\textfile{gost.pdf}, \textfile{gost2003.pdf} и
\textfile{gost2008.pdf}.

Многие журналы, принимающие публикации в \LaTeX, имеют свои
собственные \BibTeX"=стили. В стандартной поставке \TeXLive 2012 идёт
около 350 различных библиографических стилей.






Сама по себе база состоит из записей вида:
\begin{lstlisting}[language=Clean]
@book{Gussens-1999,
  author = {М. Гуссенс and Ф. Миттельбах and А. Самарин},
  title = {Путеводитель по пакету \LaTeX{} и его 
                       расширению \LaTeXe: Пер. с англ.},
  year = {1999},
  isbn = {5-03-003325-4},
  publisher = {Мир},
  address = {М.},
  numpages = {606},
  language = {russian},
  OPTnote = {}
}

\end{lstlisting}

После знака <<коммерческое at>> @ идёт тип записи. В фигурных скобках
вслед за~меткой через запятую перечисляются пары
ключ-значение. \BibTeX{} поддерживает определённый набор типов
записей, каждому из которых соответствуют свои обязательные и
необязательные поля\footnote{Если к названию необязательного поля
  добавить OPT (note\(\to\)OPTnote), то такие  поля игнорируются,
  даже если присутствуют в записи.}. Если не заполнено обязательное
поле, то при компиляции \BibTeX{} генерирует ошибку. Имеются 
стандартные типы записей (\BibTeX{} не чувствителен к регистру).
\begin{itemize}
\item \textbf{Аritcle} "--- статья в журнале. Обязательные поля:
  author, title, journal, year. Необязательные поля: volume, number,
  pages, month, note, annote.
\item \textbf{Book} "--- книга. Обязательные поля: author или editor,
  title, publisher, year. Необязательные поля: volume, number,
  series, address, edition, month, note, annote.
\item \textbf{Booklet} "--- брошюра. Обязательное поле:
  title. Необязательные поля: author, howpublished, address, month,
  year, note, annote.
\item \textbf{Conference} или \textbf{InProceedings} "--- статья,
  опубликованная в трудах конференции. Обязательные поля: author,
  title. Необязательные поля: crossref, booktitle, pages, year,
  editor, volume, number, series, address, month, organi\-sa\-tion,
  publisher, note, annote.
\item \textbf{Proceedings} "--- труды конференции. Обязательные поля:
  title, year. Необязательные поля: booktitle, editor, volume, number,
  series, address, month, organisation, publisher, note, annote.
\item \textbf{InBook} "--- ссылка на часть книги, то есть на~её главу,
  раздел или просто на~определённый набор страниц. Обязательные поля:
  author или editor, title, chapter, publisher
  year. Необязательные поля: volume или number, series, type, address,
  edition, month, pages, note, annote.
\item \textbf{InCollection} "--- часть книги со своим
  заглавием. Обязательные поля: author, title,
  booktitle. Необязательные поля: crossref, pages, publisher, year,
  editor, volume или number, series, type, chapter, address, edition,
  month, note, annote.
\item \textbf{Manual} "--- техническая документация. Обязательное
  поле: title. Необязательные поля: author, organistaion, address,
  edition, month, year, note, annote.
\item \textbf{PhdThesis} "--- диссертация. Обязательные поля: author,
  title, school, year. Необязательные поля: address, month, note,
  annote.
\item \textbf{MastersThesis} "--- дипломная работа. Обязательные и
  необязательные поля копируют \textbf{PhdThesis}.
\item \textbf{TechReport} "--- технический отчёт. Обязательные поля: author,
  title, insti\-tu\-tion, year. Необязательные поля: type, numer, address,
  month, note, annote.
\item \textbf{Unpublished} "--- неопубликованный авторский
  текст. Обязательные поля: author, title, note. Необязательные поля:
  month, year, annote.
\item \textbf{Misc} "--- то, что не подходит для других типов
  записей. Обязательные поля отсутствуют. Необязательные поля: author,
  title, howpublished, month, year, note, annote.
\end{itemize}

Значение полей в большинстве случаев понятно из их
названия. Исключением, пожалуй, является поле crossref, в
качестве значения которого можно передать ссылку на другую запись. В
этом случае \BibTeX{} при трансляции возьмёт там значения всех недостающих
полей записи. Из особенностей следует упомянуть, что авторы в поле
author разделяются с помощью союза and.

Кроме перечисленных стандартных полей при использовании
библиографических ГОСТ"=стилей \textpkg{gost2003}/\textpkg{gost2008} и
\textpkg{gost2003s}/\textpkg{gost2008s} можно использовать поля
numpages "--- число страниц и language "--- влияет
на сортировку при~выборе стиля типа \textpkg{plain}. Допустимые
значения для поля language "--- \textopt{russian},
\textopt{ukrainian} и \textopt{english} по умолчанию.



\section{Предметный указатель}
\label{sec:apparatus:makeindex}

% {\setlength{\epigraphwidth}{0.5\textwidth}
%   \epigraph{Указатель значительно повышает
%     ценность любой книги, если она из тех, что читают не только на
%     сквозь, но и выборочно.}{А.Э.\,Мильчин <<Культура издания>>}}

\mindex{указатель|(}

%\mindexemph{\textit{MakeIndex}}


Для создания <<полуфабриката>> алфавитного указателя в преамбулу
добавляется инструкция \textcmd{makeindex}. Cлова, которые нужно
поместить в указатель, отмечаются с помощью команды \textcmd{index}:
\begin{lstlisting}[]
  Указатель\index{Предметный указатель} |\ldots|

\end{lstlisting}

Сама по себе команда \textcmd{index} игнорируется, но всё, что в
ней отмечается вместе с информацией о положении команды, заносится в
файл с расширением idx. Имя idx-файла по умолчанию соответствует имени
основного документа. Полуфабрикатом idx-файл является потому, что
записи хранятся в нём в неотсортированном виде. С помощью программ
сортировки \textprog{rumakeindex}\mindex{указатель!rumakeindex}
получается уже отформатированный правильным образом указатель в файле
с расширением ind. Этот файл уже можно вставить в документ:
\textcmdh{input}
\begin{lstlisting}[]
\input{|<<ind-файл>>|}

\end{lstlisting}

\begin{figure}[t]
  \centering
  \includegraphics[width=0.5\textwidth]{apparatus/apparatus-2}
  \caption{Конвейер \LaTeX+\textit{MakeIndex}: tex "---
    \LaTeX-исходник, idx "--- не отсортированный индекс (полуфабрикат),
    ist "--- стилевой файл для указателя, ilg "--- log-файл
    \textit{MakeIndex}, ind "--- отсортированный указатель}
  \label{fig:apparatus:makeindexandlatex}
\end{figure}

Это же делает и команда \textcmd{printindex} из пакета
\textpkg{makeidx}. В дополнение к~подключению индекса команда
\textcmd{printindex}  проверяет существование индексного файла и не
даёт \LaTeX{} генерировать ошибку в случае его отсутствия. Пакет
\textpkg{makeidx} содержит ещё несколько полезных команд для создания
индекса, поэтому его в~любом случае имеет смысл загрузить.

% \subsection{makeindex/rumakeindex}
% \label{sec:apparatus:makeindex}

\mindex{указатель!makeindex|see{rumakeindex}}
\mindex{указатель!rumakeindex}

Программа \textprog{rumakeindex} является простейшим скриптом, где с
помощью \textprog{sed} кириллические буквы из внутреннего
представления \LaTeX{} переводятся в koi8-r и правильным образом
сортируются с использованием стандартного механизма
\textprog{makeindex}. Если необходимо отсортировать индексный файл для
включения в~текст, использующий другую кодовую страницу, или просто не
устраивают правила сортировки, то этот скрипт легко
переделывается. 

Оригинальная программа сортировки индекса \textprog{makeindex}
(подробная документация представлена в файле \textfile{makeindex.dvi})
была написана довольно давно и, естественно, не учитывала национальных
особенностей других языков кроме английского и немецкого. К сожалению,
она оказалась достаточно гибка, чтобы полностью отказаться от неё в
пользу другого механизма сортировки уже нормально поддерживающего
интернационализацию. Наиболее вероятным претендентом на замену уже
долгое время является \textprog{xindy}\mindex{указатель!xindy}
(см.~раздел~\ref{sec:apparatus:xindy}).


Аргумент команды \textcmd{index} может содержать любые символы
кроме !, "{}, @ и~|. Их специальное значение проявляется только внутри
команды. Чтобы убрать специальное значение этих символов внутри
\textcmd{index},  необходимо перед ними добавить символ "{} (двойную
кавычку). На рис.~\ref{fig:apparatus:idx} представлен пример
простейшего указателя. Далее будут раскрыты методы его создания.


\begin{figure}[t]
  \centering
  \fbox{\includegraphics[width=0.8\linewidth]{apparatus/apparatus-idx.eps}}
  \caption{Пример готового предметного указателя}
  \label{fig:apparatus:idx}
\end{figure}

Для формирования многоуровневых иерархических указателей используется
разделитель в виде  восклицательного знака <<!>>:
\begin{lstlisting}[]
% на страницах 110 и 111
\index{Указатель!rumakeindex} 

\end{lstlisting}

Команды \textcmd{index} с одинаковыми аргументами группируются в
одну запись с~полным списком страниц.



Символ вертикальной черты <<|>> используется для отделения видимого
аргумента от управляющих знаков. Для создания перекрёстных ссылок
внутри предметного указателя используется команда
\textopt{see}:\label{sec:apparatus:see}
\begin{lstlisting}[escapechar=]
\index{Указатель!makeindex|see{rumakeindex}}

\end{lstlisting}

\textprog{makeindex} преобразует \textopt{see} в команду
\textcmd{see}, определённую в пакете \textpkg{makeidx}. Результат
действия этой команды можно посмотреть на
рис.~\ref{fig:apparatus:idx} рядом со словом makeindex.


Также с помощью вертикальной черты можно сформировать указатель 
на~диапазон страниц:
\begin{lstlisting}[escapechar=]
% на странице 110 
\index{Указатель|(}
  много текста
% на странице 111
\index{Указатель|)}

\end{lstlisting}

Иногда номер страницы нужно как-то выделить. Команды выделения текста
также должны идти после вертикальной черты:
\begin{lstlisting}[]
% Выделяем страницу 110 жирным шрифтом
\index{MakeIndex@\textit{MakeIndex}|textbf}

\end{lstlisting}

Конструкция <<ключ>>@<<запись>> используется для правильной сортировки
внутри \textcmd{index}. По <<ключу>> производится сортировка, а
<<запись>> выводится в предметном указателе.

\mindex{указатель|)}


\subsubsection{splitidx}
\label{sec:apparatus:splitidx}

Стандартные средства создания предметных указателей в \LaTeX{}
несколько ограничены. В частности предполагается, что используется
ровно один предметный указатель. Это  решается с помощью
пакета \textpkg{splitidx}. Пусть в  \textfile{mybook.tex}
необходимо включить обычный предметный указатель и указатель
персоналий:
\begin{lstlisting}
% Преамбула
\usepackage[split]{splitidx}
% Команда на создание индексов
\makeindex
% Определение обычного указателя (метка idx)
\newindex[Алфавитный указатель]{idx}
% Определения указателя персоналий (метка aut)
\newindex[Персоналии]{aut}

  |\ldots|

% Тело документа

% Это слово записывается в основной индексный файл
\index{физика}

% Это слово записывается в файл персоналий
\sindex[aut]{Ломоносов}

% Распечатывается указатель персоналий
\printindex[aut]

% Распечатывается основной указатель
\printindex[idx]

\end{lstlisting}

В пакете определена команда \textcmd{newindex}, которой в качестве
необязательного параметра передаётся заголовок указателя, а
обязательный параметр является меткой. Пользуясь этой меткой, команда
\textcmd{sindex} направляет слово в конкретный список. Список со
стандартным именем \textfile{mybook.idx} является основным.  К~именам
файлов вспомогательных списков добавляются их метки. В
случае метки \textopt{aut} имя списка имеет вид
\textfile{mybook-aut.idx}. То есть для создания индекса необходимо
выполнить примерно такую последовательность команд:
\begin{lstlisting}[language=bash,frame=]
> latex mybook.tex
> rumakeindex mybook.idx
> rumakeindex mybook-aut.idx
> latex mybook.tex

\end{lstlisting}

Если необходимо создать очень большое количество предметных
указателей, то можно превысить лимит \TeX{} на число записываемых
файлов, которых не может быть больше 16. В этом случае необходимо
убрать опцию \textopt{split} при загрузке пакета и воспользоваться
программой разделения индексного файла \textprog{splitindex.pl},
которая идёт вместе с пакетом. Подробности об использовании следует
искать в~документации пакета \textfile{splitidx.pdf}.

\section{xindy}
\label{sec:apparatus:xindy}

\textprog{xindy} (\url{http://www.xindy.org/}) "--- современная
альтернатива \textprog{makeindex}. 
%При~использовании \textprog{xindy} не
%возникает необходимости в <<костылях>> наподобие
%скрипта \textprog{rumakeindex}. 
%\textprog{xindy} 
Программа из коробки поддерживает
десятки языков вплоть до~клингонского. \textprog{xindy} во всём
превосходит \textprog{makeindex}. Кроме поддержки множества языков при
создании индексов \textprog{xindy} автоматически проверяет
корректность перекрёстных ссылок (чуть подробнее о перекрёстных
ссылках в предметном указателе c помощью инструкции \textopt{see} на
стр.~\pageref{sec:apparatus:see}) и имеет модульную структуру,
позволяющую относительно легко писать расширения и стили.

Единственное препятствие на пути распространения \textprog{xindy} "---
это фактически полное отсутствие внятной документации для
пользователя. С документацией по~созданию своих стилей всё нормально,
но это немного другой уровень, нежели требуется автору. Также
совершенно непонятна причина, по которой \textprog{xindy}
отсутствует\footnote{\textprog{xindy} присутствует в некоторых
  современных дистрибутивах GNU/Linux, например, в~Debian (Lenny).} в
основных дистрибутивах \LaTeX. Поэтому с большой долей вероятности
программу придётся скачать с официального сайта. Со временем эти
проблемы, очевидно, разрешатся.
%\smallskip

\Note Правила сортировки для русского языка, поставляемые с
\textprog{xindy}, не разделяют буквы <<е>> и <<ё>>. Это можно
поправить при сборке пакета из исходников.
%\smallskip

Для создания указателя с помощью \textprog{xindy} проще всего
воспользоваться perl-скриптом \textprog{texindy}: 
\begin{lstlisting}[language=bash,frame=]
> texindy  -L russian -C koi8-r |<<файл>>|.idx 
\end{lstlisting}
Полное имя idx-файла набирать обязательно. Опция
\textopt{-L} позволяет передать язык (например, belarusian или
ukrainian), а опция \textopt{-C} "--- кодовую страницу документа
(например, \textcodepage{utf-8}, \textcodepage{cp1251} или
\textcodepage{koi8-u}).

\textprog{texindy} для формирования указателя вызывает
\textprog{xindy}, загружая необходимые модули. Сами по себе
загружаемые модули представляют текстовые файлы с~расширением
\textext{xdy}. Правила создания модулей подробно описаны в
документации, идущей с \textprog{xindy}. При написании своего модуля
полезно иметь общее представление о языке Lisp.

\begin{figure}[t]
  \centering
  \includegraphics[width=0.4\linewidth]{apparatus/apparatus-3}
  \caption{Конвейер \LaTeX+\textit{xindy} при создании глоссария: tex
    "--- \LaTeX-исходник, glo "--- не отсортированный глоссарий
    (полуфабрикат), xdy "--- стилевой файл для~глоссария, gls "---
    отсортированный глоссарий}
  \label{fig:apparatus:glossandlatex}
\end{figure}

Дополнительные модули можно загрузить с помощью опции \textopt{-M},
которую можно вызывать многократно. Интерес могут представлять
следующие стандартные модули (предполагается, что для создания
указателя используется программа \textprog{texindy}):
\begin{itemize}
\item Сортировка:
  \begin{description}
  \item[word-oder] "--- сортировка по словам. Пробельный символ идёт
    раньше любого знака. Загружается по умолчанию, выключается с
    помощью опции \textopt{-l};
  \item[letter-order] "--- пробельные символы игнорируются. Включается
    с помощью опции \textopt{-l};
  \item[numeric-sort] "--- числа сортируются как числа, то есть
    <<Агент7>> появится раньше чем <<Агент13>>. Этот модуль
    загружается  автоматически;
  \item[keep-blanks] "--- при создании указателя перестают
    игнорироваться ведущие и замыкающие пробельные символы;
  \item[ignore-hyphen] "--- при сортировке игнорируются тире;
  \item[ignore-punctuation] "--- при сортировке игнорируется все
    символы пунктуации.
  \end{description}
\item Нумерация страниц:
  \begin{description}
  \item[page-ranges] "--- интервалы страниц. Если элемент указателя
    присутствует на нескольких страницах подряд (например, на 35, 36,
    37 и 38 страницах), то при ссылке формируется интервал страниц
    (35--38). Загружается по умолчанию и может быть отключён с
    помощью опции \textopt{-r};
  \item[book-order] "--- книжная сортировка страниц. Правильная
    сортировка страниц для книг: сначала идут римские цифры, затем
    арабские, а затем всё остальное.
  \end{description}
\end{itemize}


\section{Глоссарий}
\label{sec:apparatus:glossary}


\begin{figure}[t]
  \centering
  \fbox{\includegraphics[width=\linewidth]{apparatus/apparatus-gloss.eps}}
  \caption{Пример глоссария}
  \label{fig:apparatus:gloss}
\end{figure}

Глоссарий (рис.~\ref{fig:apparatus:gloss}) "--- это список терминов вместе с их объяснениями. Это
краткий словарик, который позволит читателю быстро разобраться с
употребляемой в тексте терминологией. 
%Обычно глоссарий сортируется в алфавитном порядке. 
Сам глоссарий, как и указатели, создаётся внешней
программой \textprog{makeidx} или \textprog{xindy}.


\subsubsection{makegloss}
\label{sec:apparatus:makegloss}


Для создания <<полуфабриката>> глоссария по аналогии с созданием
указателей существует команда \textcmd{makegloss}, которая помещается
в преамбулу, элементы глоссария формируются с помощью команды
\textcmd{glossary}, печать же производится с~помощью команды
\textcmd{makeglossary}. На рис.~\ref{fig:apparatus:glossandlatex}
изображена схема взаимодействия \LaTeX{} и \textprog{xindy} при
создании глоссария.




Для подготовки заготовки для глоссария и, собственно, формирования
глоссария лучше воспользоваться пакетом
\textpkg{makeglos}. Подробности можно поискать в~файле документации
\textfile{makeglos.pdf}, а примеры создания глоссария можно посмотреть
в его исходнике \textfile{makeglos.tex}. В этом пакете определяются
дополнительные команды, необходимые для формирования глоссария.
\textcmdh{makeglossary}
\textcmdh{glossaryname}
\textcmdh{printglossary}
\textcmdh{glossary}
\begin{lstlisting}[escapechar=!]
%Преамбула
\usepackage{makeglos}
% Команда создания заготовки для глоссария glo-файла
\makeglossary
 !\ldots!
% Тело документа
% Определение заголовка глоссария
\renewcommand{\glossaryname}{Глоссарий}
% Добавление ссылки на глоссарий в оглавление
\addcontentsline{toc}{section}{\glossaryname}
% Печать готового глоссария  gls-файла
\printglossary{}
% Создание заготовки для глоссария
\glossary{Указатель:упорядоченный перечень объектов текста, 
  благодаря чему можно быстро находить сведения об этих 
  объектах!,! когда требуется справка или выборочное чтение 
  издания}
\glossary{Глоссарий:собрание глосс!,! предшественник словаря}
\glossary{xindy|is{программа для формирования вспомогательного 
  указателя!,! может использоваться и для создания глоссария}}
\glossary{xindy|see{Указатель}}
\glossary{xindy|seealso{Глоссарий}}
\end{lstlisting}

Словарное слово отделяется двоеточием от своего определения. Также
можно слово и определение разделить вертикальной чертой, но в этом
случае необходимо воспользоваться лексемой \textopt{is}. Каждое
слово можно определять с помощью \textcmd{glossary} несколько раз. 

Команда \textcmd{glossaryname} хранит заголовок
глоссария. Переопределив аналогичным образом команду
\textcmd{glossaryintro}, перед началом глоссария можно добавить
введение.

Для создания перекрёстных ссылок можно использовать лексемы
\textopt{see} и \textopt{seealso}. При компиляции
glo-файла они заменяются на макросы \textcmd{gsee} и
\textcmd{galso}:
\begin{lstlisting}[language=bash,frame=]
> texindy |<<файл>>|.glo -o |<<файл>>|.gls -M makeglos \
       -L russian -C koi8-r
\end{lstlisting}

Чтобы сформировать глоссарий, \textprog{texindy} необходимо загрузить с
помощью опции \textopt{-M} специальный стилевой файл
\textfile{makeglos.xdy}. Он лежит в той же директории, где и
документация к пакету \textpkg{makeglos}. Файл проще всего просто
скопировать в~рабочую директорию.

\subsubsection{gloss}
\label{sec:apparatus:gloss}

Пакет \textpkg{gloss} позволяет создать глоссарий с использованием
базы \BibTeX. Для~этого отдельно от основного текста необходимо
записать словарик в bib-файл. Каждый элемент словарика будет
иметь примерно следующий вид:
\begin{lstlisting}[language=Clean]
@gd{gnu,
word = {ГНУ},
definition = {Дикое животное}
}
\end{lstlisting}

В данном примере \textopt{gnu} "--- это метка, на которую можно
сослаться в тексте с~помощью команды \textcmd{gloss}. Ключ
\textopt{word} соответствует словарной статье. Это имя появляется в
тексте при ссылке на неё. Если ранее был загружен пакет
\textpkg{hyperref}, то формируется гиперссылка на соответствующую
статью в глоссарии. Определение формируется с помощью ключа
\textopt{definition}.

Сам текст должен содержать следующие команды:
\begin{lstlisting}[escapechar=!]
% Преамбула
\usepackage{gloss}
% Команда создания списка в gls.aux-файле
\makegloss
 !\ldots!
% Тело документа
% Ссылка на словарную статью ГНУ
\gloss{gnu}
% Определение заголовка глоссария
\renewcommand{\glossname}{Глоссарий}
% Печать глоссария
\printgloss{|<<имя bib-файла|}

\end{lstlisting}

Порядок действий при создании глоссария примерно следующий:
\begin{itemize}
\item компиляция tex-файла,
\item формирование глоссария с помощью \BibTeX{} на основании записей
  в gls.aux-файле, иными словами следует выполнить команду:
\begin{lstlisting}[language=bash,frame=]
> bibtex8 |имя bib-файла|.gls
\end{lstlisting}
\item компиляция tex-файла для вставки глоссария,
\item компиляция tex-файла для правильного вывода  
  перекрёстных ссылок.
\end{itemize}

Пакет позволяет поддерживать несколько глоссариев. Об этом и о многом
другом можно узнать в файле документации  \textfile{gloss.dvi}

\subsubsection{nomencl}
\label{sec:apparatus:nomencl}

\mindex{номенклатура}

Пакет \textpkg{nomencl} позволяет создать список используемых в тексте
обозначений. Этот список по своей структуре похож на обычный
глоссарий, только в качестве описываемых терминов здесь предполагаются
спецсимволы, хотя это и не обязательно.

\textcmdh{makenomenclature}
\textcmdh{printnomenclature}
\begin{lstlisting}
% Преамбула
\usepackage[russian]{nomencl}
% Команда создания списка в nlo-файле
\makenomenclature
 |\ldots|
% Тело документа
\nomenclature[W]{\Warning}{Предупреждение}
\nomenclature[E]{\Error}{Ошибка}

% Печать списка символов
\printnomenclature

\end{lstlisting}

Команда \textcmd{nomenclature} добавляет элементы в список. Кроме
обязательных двух параметров символ и описание, команде в качестве
необязательного параметра можно передать префикс, который будет
использоваться для сортировки списка. В показанном ранее примере при
печати <<Ошибка>> будет находиться раньше <<Предупреждения>>.

Для создания списка программе \textprog{makeindex} необходимо указать
стилевой файл \textfile{nomencl.ist}:
\begin{lstlisting}[language=bash,frame=]
> makeindex |<<имя>>|.nlo -s nomencl.ist -o |<<имя>>|.nls
\end{lstlisting}

Примеры и качественное описание пакета представлены в файле
\textfile{nomencl.pdf}.


%\section*{Заключение}



%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "../ctex"
%%% End: 
